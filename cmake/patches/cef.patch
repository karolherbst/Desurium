diff '--exclude=.svn' -aurN cef.ori/cef.gypi cef/cef.gypi
--- cef.gypi	2012-05-09 11:27:19.093674201 +0200
+++ cef.gypi	2012-05-09 11:32:01.267658243 +0200
@@ -11,6 +11,7 @@
       }, { # OS!="win"
         'cef_directory' : '<!(echo $CEF_DIRECTORY)',
       }],
-    ]
+    ],
+	'use_system_zlib':0,
   },
 }
diff '--exclude=.svn' -aurN cef.ori/cef_resources.grd cef/cef_resources.grd
--- cef_resources.grd	1970-01-01 01:00:00.000000000 +0100
+++ cef_resources.grd	2012-05-09 11:32:01.269658243 +0200
@@ -0,0 +1,16 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<grit latest_public_release="0" current_release="1">
+  <outputs>
+    <output filename="grit/cef_resources.h" type="rc_header">
+      <emit emit_type='prepend'></emit>
+    </output>
+    <output filename="cef_resources.pak" type="data_package" />
+  </outputs>
+  <release seq="1">
+    <includes>
+      <include name="IDR_AHEM_FONT" file="resources\AHEM____.TTF" type="BINDATA" />
+      <include name="IDR_BROKENIMAGE" file="resources\missingImage.gif" type="BINDATA" />
+      <include name="IDR_TEXTAREA_RESIZER" file="resources\textAreaResizeCorner.png" type="BINDATA" />
+    </includes>
+  </release>
+</grit>
diff '--exclude=.svn' -aurN cef.ori/include/cef_capi.h cef/include/cef_capi.h
--- include/cef_capi.h	2012-05-09 11:27:17.734674278 +0200
+++ include/cef_capi.h	2012-05-09 11:32:01.270658243 +0200
@@ -41,6 +41,8 @@
 extern "C" {
 #endif
 
+#include <inttypes.h>
+
 #include "internal/cef_export.h"
 #include "internal/cef_string.h"
 #include "internal/cef_string_list.h"
@@ -344,7 +346,7 @@
 // Check that the structure |s|, which is defined with a cef_base_t member named
 // |base|, is large enough to contain the specified member |f|.
 #define CEF_MEMBER_EXISTS(s, f)   \
-  ((int)&((s)->f) - (int)(s) + sizeof((s)->f) <= (s)->base.size)
+  ((uintptr_t)&((s)->f) - (uintptr_t)(s) + sizeof((s)->f) <= (s)->base.size)
 
 #define CEF_MEMBER_MISSING(s, f)  (!CEF_MEMBER_EXISTS(s, f) || !((s)->f))
 
diff '--exclude=.svn' -aurN cef.ori/include/cef.h cef/include/cef.h
--- include/cef.h	2012-05-09 11:27:17.735674278 +0200
+++ include/cef.h	2012-05-09 11:32:01.269658243 +0200
@@ -119,6 +121,10 @@
 /*--cef()--*/
 void CefRunMessageLoop();
 
+// Registers chrome flash plugin
+/*--cef()--*/ 
+void CefRegisterFlashPlugin(const std::string& dllName);
+
 ///
 // Register a new V8 extension with the specified JavaScript extension code and
 // handler. Functions implemented by the handler are prototyped using the
@@ -430,21 +436,50 @@
   ///
   // Atomic reference increment.
   ///
-  int AddRef() {
+  virtual int AddRef() {
+    return CefAtomicIncrement(&refct_);
+  }
+
+  ///
+  // Atomic reference decrement. Delete the object when no references remain.
+  ///
+  virtual int Release() {
+    return CefAtomicDecrement(&refct_);
+  }
+
+  ///
+  // Return the current number of references.
+  ///
+  virtual int GetRefCt() { return refct_; }
+
+private:
+  long refct_;
+};
+
+template <typename T>
+class CefRefCountWrapper : public T
+{
+public:
+  CefRefCountWrapper() : refct_(0) {}
+
+  ///
+  // Atomic reference increment.
+  ///
+  virtual int AddRef() {
     return CefAtomicIncrement(&refct_);
   }
 
   ///
   // Atomic reference decrement. Delete the object when no references remain.
   ///
-  int Release() {
+  virtual int Release() {
     return CefAtomicDecrement(&refct_);
   }
 
   ///
   // Return the current number of references.
   ///
-  int GetRefCt() { return refct_; }
+  virtual int GetRefCt() { return refct_; }
 
 private:
   long refct_;
@@ -701,6 +736,16 @@
   /*--cef()--*/
   virtual void SetZoomLevel(double zoomLevel) =0;
 
+#ifndef IGNORE_DESURA
+  // Inspect a element. Parse -1, -1 for any
+  /*--cef()--*/
+  virtual void InspectElement(int x, int y) =0; 
+
+  // Handle mouse rotation
+  /*--cef()--*/
+  virtual void MouseWheelEvent(int x, int y, int delta, unsigned int flags) =0;
+#endif
+
   ///
   // Open developer tools in its own window.
   ///
@@ -951,6 +996,20 @@
   /*--cef()--*/
   virtual CefRefPtr<CefBrowser> GetBrowser() =0;
 
+#ifndef IGNORE_DESURA
+  // zoom in
+  /*--cef()--*/
+  virtual void ZoomIn() =0;
+
+  // Zoom out
+  /*--cef()--*/
+  virtual void ZoomOut() =0;
+
+  // Set zoom to default
+  /*--cef()--*/
+  virtual void ZoomNormal() =0;
+#endif
+
   ///
   // Visit the DOM document.
   ///
@@ -1304,6 +1363,7 @@
 public:
   typedef cef_handler_menuid_t MenuId;
   typedef cef_handler_menuinfo_t MenuInfo;
+  typedef cef_handler_menuitem_t MenuItem;
 
   ///
   // Called before a context menu is displayed. Return false to display the
@@ -1581,6 +1641,20 @@
 
 
 ///
+// Implement this interface to handle window proc events. The methods of
+// this class will be called on the UI thread.
+///
+/*--cef(source=client)--*/
+class CefWinEventHandler : public virtual CefBase
+{
+public:
+  ///
+  /*--cef()--*/
+  virtual void OnWndProc(CefRefPtr<CefBrowser> browser, int message, int wparam, int lparam){}
+};
+
+
+///
 // Implement this interface to provide handler implementations.
 ///
 /*--cef(source=client)--*/
@@ -1664,6 +1738,12 @@
   ///
   /*--cef()--*/
   virtual CefRefPtr<CefDragHandler> GetDragHandler() { return NULL; }
+
+  ///
+  // Return the handler for windows events.
+  ///
+  /*--cef()--*/
+  virtual CefRefPtr<CefWinEventHandler>	GetWinEventHandler() { return NULL; }
 };
 
 
diff '--exclude=.svn' -aurN cef.ori/include/internal/cef_string.h cef/include/internal/cef_string.h
--- include/internal/cef_string.h	2012-05-09 11:27:17.743674277 +0200
+++ include/internal/cef_string.h	2012-05-09 11:32:01.271658243 +0200
@@ -35,10 +35,10 @@
 // If you change the default you MUST recompile all of CEF.
 
 // Build with the UTF8 string type as default.
-//#define CEF_STRING_TYPE_UTF8 1
+#define CEF_STRING_TYPE_UTF8 1
 
 // Build with the UTF16 string type as default.
-#define CEF_STRING_TYPE_UTF16 1
+//#define CEF_STRING_TYPE_UTF16 1
 
 // Build with the wide string type as default.
 //#define CEF_STRING_TYPE_WIDE 1
diff '--exclude=.svn' -aurN cef.ori/include/internal/cef_types.h cef/include/internal/cef_types.h
--- include/internal/cef_types.h	2012-05-09 11:27:17.742674276 +0200
+++ include/internal/cef_types.h	2012-05-09 11:32:01.610658223 +0200
@@ -590,6 +591,26 @@
   V8_PROPERTY_ATTRIBUTE_DONTDELETE = 1 << 2   // Not configurable
 };
 
+typedef struct _cef_handler_menuitem_t
+{
+  int action;
+  int type;
+  int enabled;
+  int checked;
+
+  cef_string_t label;
+} cef_handler_menuitem_t;
+
+// The cef_handler_menuinfo_t typeFlags value will be a combination of the
+// following values.
+enum cef_handler_menuitemtype_t
+{
+  MENUITEMTYPE_SEPERATOR = 1,
+  MENUITEMTYPE_OPTION,
+  MENUITEMTYPE_CHECKABLEOPTION,
+  MENUITEMTYPE_GROUP,
+};
+
 ///
 // Structure representing menu information.
 ///
@@ -620,6 +641,10 @@
   int editFlags;
 
   cef_string_t securityInfo;
+
+  int customSize;
+  cef_handler_menuitem_t* customItems;
+
 } cef_handler_menuinfo_t;
 
 ///
@@ -710,6 +735,10 @@
   MENU_ID_SELECTALL = 26,
   MENU_ID_PRINT = 30,
   MENU_ID_VIEWSOURCE = 31,
+  MENU_ID_ZOOM_IN  = 33,
+  MENU_ID_ZOOM_OUT = 34,
+  MENU_ID_ZOOM_NORMAL = 35,
+  MENU_ID_CUSTOM = 100, //used for custom menu items from js. Needs to be last
 };
 
 enum cef_paint_element_type_t
diff '--exclude=.svn' -aurN cef.ori/include/internal/cef_types_linux.h cef/include/internal/cef_types_linux.h
--- include/internal/cef_types_linux.h	2012-05-09 11:27:17.737674277 +0200
+++ include/internal/cef_types_linux.h	2012-05-09 11:32:01.618658223 +0200
@@ -50,6 +50,11 @@
 {
   // Pointer for the parent GtkBox widget.
   cef_window_handle_t m_ParentWidget;
+
+  int m_x;
+  int m_y;
+  int m_nWidth;
+  int m_nHeight;
   
   // Pointer for the new browser widget.
   cef_window_handle_t m_Widget;
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_impl.cc cef/libcef/browser_impl.cc
--- libcef/browser_impl.cc	2012-05-09 11:27:19.075674202 +0200
+++ libcef/browser_impl.cc	2012-05-09 11:32:01.624658223 +0200
@@ -33,6 +33,10 @@
 #include "webkit/plugins/npapi/webplugin_impl.h"
 #include "webkit/glue/webkit_glue.h"
 
+#if defined(OS_WIN)
+#include "third_party/WebKit/Source/WebKit/chromium/public/win/WebInputEventFactory.h"
+#endif
+
 using WebKit::WebDocument;
 using WebKit::WebFrame;
 using WebKit::WebHTTPBody;
@@ -519,6 +523,46 @@
   return CefString();
 }
 
+void CefBrowserImpl::ZoomOut(CefRefPtr<CefFrame> frame)
+{
+  frame->AddRef();
+  CefThread::PostTask(CefThread::UI, FROM_HERE, NewRunnableMethod(this,
+      &CefBrowserImpl::UIT_HandleAction, MENU_ID_ZOOM_OUT, frame.get()));
+}
+
+void CefBrowserImpl::ZoomIn(CefRefPtr<CefFrame> frame)
+{
+  frame->AddRef();
+  CefThread::PostTask(CefThread::UI, FROM_HERE, NewRunnableMethod(this,
+      &CefBrowserImpl::UIT_HandleAction, MENU_ID_ZOOM_IN, frame.get()));
+}
+
+void CefBrowserImpl::ZoomNormal(CefRefPtr<CefFrame> frame)
+{
+  frame->AddRef();
+  CefThread::PostTask(CefThread::UI, FROM_HERE, NewRunnableMethod(this,
+      &CefBrowserImpl::UIT_HandleAction, MENU_ID_ZOOM_NORMAL, frame.get()));
+}
+ 
+ void CefBrowserImpl::CustomContextMenuAction(int action)
+ {
+  CefThread::PostTask(CefThread::UI, FROM_HERE, NewRunnableMethod(this,
+      &CefBrowserImpl::UIT_CustomContextMenuAction, action));
+ }
+ 
+ void CefBrowserImpl::InspectElement(int x, int y)
+ {
+  CefThread::PostTask(CefThread::UI, FROM_HERE, NewRunnableMethod(this,
+      &CefBrowserImpl::UIT_InspectElement, x, y));
+ }
+
+ void CefBrowserImpl::MouseWheelEvent(int x, int y, int delta, unsigned int flags)
+ {
+  CefThread::PostTask(CefThread::UI, FROM_HERE, NewRunnableMethod(this,
+      &CefBrowserImpl::UIT_MouseWheelEvent, x, y, delta, flags));
+ }
+
+
 CefString CefBrowserImpl::GetText(CefRefPtr<CefFrame> frame)
 {
   // Verify that this method is being called on the UI thread.
@@ -666,6 +710,9 @@
 
 WebFrame* CefBrowserImpl::UIT_GetWebFrame(CefRefPtr<CefFrame> frame)
 {
+  if (!frame)
+  	return NULL;
+  	
   REQUIRE_UIT();
 
   WebView* view = UIT_GetWebView();
@@ -719,8 +766,20 @@
     dev_tools_agent_.reset();
   }
 
+  //this happens when webviewhost gets reset on linux
+#ifndef OS_LINUX
   // Clean up anything associated with the WebViewHost widget.
-  UIT_GetWebViewHost()->webwidget()->close();
+  WebViewHost* webViewHost = UIT_GetWebViewHost();
+  
+  if (webViewHost)
+  {
+    WebKit::WebWidget* webWidget = webViewHost->webwidget();
+    
+    if (webWidget)
+      webWidget->close();
+  }
+#endif
+
   webviewhost_.reset();
 
   // Remove the reference added in UIT_CreateBrowser().
@@ -1155,14 +1214,27 @@
   delegate_->show(policy);
 }
 
-void CefBrowserImpl::UIT_HandleActionView(cef_handler_menuid_t menuId)
+bool CefBrowserImpl::UIT_HandleActionView(cef_handler_menuid_t menuId)
 {
   return UIT_HandleAction(menuId, NULL);
 }
 
-void CefBrowserImpl::UIT_HandleAction(cef_handler_menuid_t menuId,
+void CefBrowserImpl::UIT_MouseWheelEvent(int x, int y, int delta, unsigned int flags)
+{
+#if defined(OS_WIN)
+  if (UIT_GetWebViewHost())
+  {
+    const WebKit::WebMouseWheelEvent& event = WebKit::WebInputEventFactory::mouseWheelEvent(UIT_GetWebViewWndHandle(), WM_MOUSEWHEEL, MAKEWPARAM(flags, delta), MAKELPARAM(x, y));
+	UIT_GetWebViewHost()->webwidget()->handleInputEvent(event); 
+  }
+#endif
+}
+
+bool CefBrowserImpl::UIT_HandleAction(CefMenuHandler::MenuId menuId,
                                       CefRefPtr<CefFrame> frame)
 {
+  bool res = true;
+
   REQUIRE_UIT();
 
   WebFrame* web_frame = NULL;
@@ -1223,7 +1295,23 @@
       if(web_frame)
         UIT_ViewDocumentString(web_frame);
       break;
+    case MENU_ID_ZOOM_IN:
+      if(web_frame)
+        web_frame->view()->setZoomLevel(false, web_frame->view()->zoomLevel()+1);
+      break;
+    case MENU_ID_ZOOM_OUT:
+      if(web_frame)
+        web_frame->view()->setZoomLevel(false, web_frame->view()->zoomLevel()-1);
+      break;
+    case MENU_ID_ZOOM_NORMAL:
+      if(web_frame)
+        web_frame->view()->setZoomLevel(false, 0);
+      break;
+	default:
+		res = false;
   }
+
+  return res;
 }
 
 void CefBrowserImpl::UIT_Find(int identifier, const CefString& search_text,
@@ -1559,6 +1647,19 @@
   }
 }
 
+void CefBrowserImpl::UIT_CustomContextMenuAction(int action)
+{
+  if (UIT_GetWebViewHost() && UIT_GetWebViewHost()->webview())
+    UIT_GetWebViewHost()->webview()->performCustomContextMenuAction(action);
+}
+
+ void CefBrowserImpl::UIT_InspectElement(int x, int y)
+ {
+  if (UIT_GetWebViewHost() && UIT_GetWebViewHost()->webview())
+	  UIT_GetWebViewHost()->webview()->inspectElementAt(WebKit::WebPoint(x,y));
+ }
+
+
 
 // CefFrameImpl
 
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_impl_gtk.cc cef/libcef/browser_impl_gtk.cc
--- libcef/browser_impl_gtk.cc	2012-05-09 11:27:19.070674202 +0200
+++ libcef/browser_impl_gtk.cc	2012-05-09 11:32:01.625658223 +0200
@@ -18,6 +18,12 @@
 using WebKit::WebRect;
 using WebKit::WebSize;
 
+void BrowserParentDestroyed(GtkWidget *window, CefBrowserImpl* browser)
+{	
+  // Destroy the browser.
+  browser->UIT_DestroyBrowser();
+}
+
 void CefBrowserImpl::ParentWindowWillClose()
 {
   // TODO(port): Implement this method if necessary.
@@ -35,17 +41,20 @@
   return false;
 }
 
-gfx::NativeWindow CefBrowserImpl::UIT_GetMainWndHandle() {
+gfx::NativeView CefBrowserImpl::UIT_GetMainWndHandle() {
   REQUIRE_UIT();
-  GtkWidget* toplevel = gtk_widget_get_ancestor(window_info_.m_Widget,
+  GtkWidget* toplevel = gtk_widget_get_ancestor((GtkWidget*)window_info_.m_Widget,
       GTK_TYPE_WINDOW);
-  return GTK_IS_WINDOW(toplevel) ? GTK_WINDOW(toplevel) : NULL;
+  return GTK_IS_WIDGET(toplevel) ? GTK_WIDGET(toplevel) : NULL;
 }
 
 void CefBrowserImpl::UIT_CreateBrowser(const CefString& url)
 {
   REQUIRE_UIT();
   Lock();
+  
+  if (!settings_.developer_tools_disabled)
+    dev_tools_agent_.reset(new BrowserDevToolsAgent());
 
   // Add a reference that will be released in UIT_DestroyBrowser().
   AddRef();
@@ -53,18 +62,14 @@
   // Add the new browser to the list maintained by the context
   _Context->AddBrowser(this);
 
-  if (!settings_.developer_tools_disabled)
-    dev_tools_agent_.reset(new BrowserDevToolsAgent());
-
   WebPreferences prefs;
   BrowserToWebSettings(settings_, prefs);
 
   // Create the webview host object
   webviewhost_.reset(
-      WebViewHost::Create(window_info_.m_ParentWidget, gfx::Rect(),
-                          delegate_.get(), NULL, dev_tools_agent_.get(),
-                          prefs));
-
+      WebViewHost::Create((GtkWidget*)window_info_.m_ParentWidget, delegate_.get(), dev_tools_agent_.get(), prefs)
+  );
+  
   if (!settings_.developer_tools_disabled)
     dev_tools_agent_->SetWebView(webviewhost_->webview());
 
@@ -72,12 +77,18 @@
 
   Unlock();
 
-  if(handler_.get()) {
-    // Notify the handler that we're done creating the new window
-    handler_->HandleAfterCreated(this);
+  g_signal_connect(GTK_WIDGET(window_info_.m_ParentWidget), "destroy", 
+		   G_CALLBACK(BrowserParentDestroyed), this);
+
+  if (client_.get()) {
+    CefRefPtr<CefLifeSpanHandler> handler = client_->GetLifeSpanHandler();
+    if(handler.get()) {
+      // Notify the handler that we're done creating the new window
+      handler->OnAfterCreated(this);
+    }
   }
 
-  if(url.size() > 0)
+  if(url.length() > 0)
     UIT_LoadURL(GetMainFrame(), url);
 }
 
@@ -95,9 +106,38 @@
 {
   REQUIRE_UIT();
 
-  // TODO(port): Add implementation.
-  NOTIMPLEMENTED();
-  return false;
+  char buff[] = "/tmp/CEFSourceXXXXXX";
+  int fd = mkstemp(buff);
+
+  if (fd == -1)
+    return false;
+
+  FILE* srcOutput;
+  srcOutput = fdopen(fd, "w+");
+
+  if (!srcOutput)
+    return false;
+ 
+  std::string markup = frame->contentAsMarkup().utf8();
+  if (fputs(markup.c_str(), srcOutput) < 0)
+  {
+    fclose(srcOutput);
+	return false;
+  }
+
+  fclose(srcOutput);
+  std::string newName(buff);
+  newName.append(".txt");
+  if (rename(buff, newName.c_str()) != 0)
+    return false;
+
+  std::string openCommand("xdg-open ");
+  openCommand += newName;
+
+  if (system(openCommand.c_str()) != 0)
+    return false;
+
+  return true;
 }
 
 void CefBrowserImpl::UIT_PrintPage(int page_number, int total_pages,
@@ -128,6 +168,26 @@
 // static
 void CefBrowserImpl::UIT_CloseView(gfx::NativeView view)
 {
+  if (!view)
+    return;
+    
+  GtkWidget* window = gtk_widget_get_parent(gtk_widget_get_parent(GTK_WIDGET(view)));
+  
+  if (!window)
+    return;
+    
   MessageLoop::current()->PostTask(FROM_HERE, NewRunnableFunction(
-      &gtk_widget_destroy, GTK_WIDGET(view)));
+      &gtk_widget_destroy, GTK_WIDGET(window)));
+}
+
+// static
+bool CefBrowserImpl::UIT_IsViewVisible(gfx::NativeView view)
+{
+  if (!view)
+    return false;
+    
+  if (view->window)
+    return (bool)gdk_window_is_visible(view->window);
+  else
+    return false;
 }
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_impl.h cef/libcef/browser_impl.h
--- libcef/browser_impl.h	2012-05-09 11:27:19.070674202 +0200
+++ libcef/browser_impl.h	2012-05-09 11:32:01.625658223 +0200
@@ -107,6 +107,14 @@
   virtual void SendFocusEvent(bool setFocus) OVERRIDE;
   virtual void SendCaptureLostEvent() OVERRIDE;
 
+  virtual void CustomContextMenuAction(int action);
+  virtual void ZoomIn(CefRefPtr<CefFrame> frame);
+  virtual void ZoomOut(CefRefPtr<CefFrame> frame);
+  virtual void ZoomNormal(CefRefPtr<CefFrame> frame); 
+  virtual void InspectElement(int x, int y);
+  virtual void MouseWheelEvent(int x, int y, int delta, unsigned int flags);
+  
+  
   // Frame-related methods
   void Undo(CefRefPtr<CefFrame> frame);
   void Redo(CefRefPtr<CefFrame> frame);
@@ -274,8 +282,8 @@
   void UIT_Show(WebKit::WebNavigationPolicy policy);
   
   // Handles most simple browser actions
-  void UIT_HandleActionView(cef_handler_menuid_t menuId);
-  void UIT_HandleAction(cef_handler_menuid_t menuId, CefRefPtr<CefFrame> frame);
+  bool UIT_HandleActionView(cef_handler_menuid_t menuId);
+  bool UIT_HandleAction(cef_handler_menuid_t menuId, CefRefPtr<CefFrame> frame);
 
   // Save the document HTML to a temporary file and open in the default viewing
   // application
@@ -303,6 +311,10 @@
   void UIT_ShowDevTools();
   void UIT_CloseDevTools();
 
+  void UIT_CustomContextMenuAction(int action);
+  void UIT_InspectElement(int x, int y);
+  void UIT_MouseWheelEvent(int x, int y, int delta, unsigned int flags);
+
   void UIT_VisitDOM(CefRefPtr<CefFrame> frame,
                     CefRefPtr<CefDOMVisitor> visitor);
 
@@ -441,6 +453,9 @@
   virtual CefRefPtr<CefBrowser> GetBrowser() OVERRIDE { return browser_.get(); }
   virtual void VisitDOM(CefRefPtr<CefDOMVisitor> visitor) OVERRIDE;
 
+  virtual void ZoomIn(){ browser_->ZoomIn(this); }
+  virtual void ZoomOut(){ browser_->ZoomOut(this); }
+  virtual void ZoomNormal(){ browser_->ZoomNormal(this); }
 private:
   CefRefPtr<CefBrowserImpl> browser_;
   CefString name_;
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_request_context.cc cef/libcef/browser_request_context.cc
--- libcef/browser_request_context.cc	2012-05-09 11:27:19.049674201 +0200
+++ libcef/browser_request_context.cc	2012-05-09 11:32:01.625658223 +0200
@@ -73,6 +73,7 @@
     const FilePath& cache_path,
     net::HttpCache::Mode cache_mode,
     bool no_proxy) {
+#ifdef OS_WIN // leaving old code here for now as new code is slower in windows
   // Create the |cache_path| directory if necessary.
   bool cache_path_valid = false;
   if (!cache_path.empty()) {
@@ -183,6 +184,92 @@
           file_system_context_.get(),
           CefThread::GetMessageLoopProxyForThread(CefThread::FILE)));
   storage_.set_job_factory(job_factory);
+#else // newer proxy code below here. Not used for Windows yet. 
+  // Create the |cache_path| directory if necessary.
+  bool cache_path_valid = false;
+  if (!cache_path.empty()) {
+    if (file_util::CreateDirectory(cache_path))
+      cache_path_valid = true;
+    else
+      NOTREACHED() << "The cache_path directory could not be created";
+  }
+
+  scoped_refptr<BrowserPersistentCookieStore> persistent_store;
+  if (cache_path_valid) {
+    const FilePath& cookie_path = cache_path.AppendASCII("Cookies");
+    persistent_store = new BrowserPersistentCookieStore(cookie_path);
+  }
+
+  storage_.set_cookie_store(
+      new net::CookieMonster(persistent_store.get(), NULL));
+
+  // hard-code A-L and A-C for test shells
+  set_accept_language("en-us,en");
+  set_accept_charset("iso-8859-1,*,utf-8");
+
+#if defined(OS_POSIX) && !defined(OS_MACOSX)
+  // Use no proxy to avoid ProxyConfigServiceLinux.
+  // Enabling use of the ProxyConfigServiceLinux requires:
+  // -Calling from a thread with a TYPE_UI MessageLoop,
+  // -If at all possible, passing in a pointer to the IO thread's MessageLoop,
+  // -Keep in mind that proxy auto configuration is also
+  //  non-functional on linux in this context because of v8 threading
+  //  issues.
+  // TODO(port): rename "linux" to some nonspecific unix.
+  scoped_ptr<net::ProxyConfigService> proxy_config_service(
+      new net::ProxyConfigServiceFixed(net::ProxyConfig()));
+#else // This is not used for now as it causes significant slowness
+  // Use the system proxy settings.
+  scoped_ptr<net::ProxyConfigService> proxy_config_service(
+      net::ProxyService::CreateSystemProxyConfigService(
+          MessageLoop::current(), NULL));
+#endif
+  storage_.set_host_resolver(
+      net::CreateSystemHostResolver(net::HostResolver::kDefaultParallelism,
+                                    net::HostResolver::kDefaultRetryAttempts,
+                                    NULL));
+  storage_.set_cert_verifier(new net::CertVerifier);
+  storage_.set_proxy_service(net::ProxyService::CreateUsingSystemProxyResolver(
+      proxy_config_service.release(), 0, NULL));
+  storage_.set_ssl_config_service(
+      new net::SSLConfigServiceDefaults);
+
+  storage_.set_http_auth_handler_factory(
+      net::HttpAuthHandlerFactory::CreateDefault(host_resolver()));
+
+  net::HttpCache::DefaultBackend* backend = new net::HttpCache::DefaultBackend(
+      cache_path.empty() ? net::MEMORY_CACHE : net::DISK_CACHE,
+      cache_path, 0, BrowserResourceLoaderBridge::GetCacheThread());
+
+  net::HttpCache* cache =
+      new net::HttpCache(host_resolver(), cert_verifier(),
+                         origin_bound_cert_service(), NULL, NULL,
+                         proxy_service(), ssl_config_service(),
+                         http_auth_handler_factory(), NULL, NULL, backend);
+
+  cache->set_mode(cache_mode);
+  storage_.set_http_transaction_factory(cache);
+
+  storage_.set_ftp_transaction_factory(
+      new net::FtpNetworkLayer(host_resolver()));
+
+  blob_storage_controller_.reset(new webkit_blob::BlobStorageController());
+  file_system_context_ = static_cast<BrowserFileSystem*>(
+      WebKit::webKitPlatformSupport()->fileSystem())->file_system_context();
+
+  net::URLRequestJobFactory* job_factory = new net::URLRequestJobFactory;
+  job_factory->SetProtocolHandler(
+      "blob",
+      new webkit_blob::BlobProtocolHandler(
+          blob_storage_controller_.get(),
+          CefThread::GetMessageLoopProxyForThread(CefThread::FILE)));
+  job_factory->SetProtocolHandler(
+      "filesystem",
+      fileapi::CreateFileSystemProtocolHandler(
+          file_system_context_.get(),
+          CefThread::GetMessageLoopProxyForThread(CefThread::FILE)));
+  storage_.set_job_factory(job_factory);
+#endif
 }
 
 BrowserRequestContext::~BrowserRequestContext() {
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_webkit_glue_gtk.cc cef/libcef/browser_webkit_glue_gtk.cc
--- libcef/browser_webkit_glue_gtk.cc	1970-01-01 01:00:00.000000000 +0100
+++ libcef/browser_webkit_glue_gtk.cc	2012-05-09 11:32:01.627658222 +0200
@@ -0,0 +1,105 @@
+// Copyright (c) 2010 The Chromium Embedded Framework Authors.
+// Portions copyright (c) 2006-2008 The Chromium Authors. All rights reserved.
+// Use of this source code is governed by a BSD-style license that can be
+// found in the LICENSE file.
+
+#include "base/compiler_specific.h"
+
+#include "third_party/WebKit/Source/WebCore/config.h"
+
+#include "browser_webkit_glue.h"
+
+#undef LOG
+#include "base/file_util.h"
+#include "base/logging.h"
+#include "base/path_service.h"
+#include "grit/webkit_resources.h"
+#include "ui/base/resource/data_pack.h"
+#include "ui/base/resource/resource_bundle.h"
+#include "webkit/glue/webkit_glue.h"
+
+namespace webkit_glue {
+  
+// Data pack resource. This is a pointer to the mmapped resources file.
+static ui::DataPack* g_resource_data_pack = NULL;
+
+
+const char* PATH_ENV = "CEF_DATA_PATH";
+
+// Helper method for getting the path to the CEF resources directory.
+FilePath GetResourcesFilePath() {
+  return FilePath(getenv(PATH_ENV));
+}
+  
+void InitializeDataPak() {
+  g_resource_data_pack = new ui::DataPack;
+  FilePath data_path;
+  data_path = data_path.Append(GetResourcesFilePath());
+  data_path = data_path.Append("cef_data.pak");
+
+  if (!g_resource_data_pack->Load(data_path)) {
+    LOG(FATAL) << "failed to load cef_data.pak";
+  }
+  ResourceBundle::InitSharedInstanceForTest(data_path); // resources
+}
+  
+string16 GetLocalizedString(int message_id) {
+  base::StringPiece res;
+  if (!g_resource_data_pack->GetStringPiece(message_id, &res)) {
+    LOG(FATAL) << "failed to load webkit string with id " << message_id;
+  }
+  
+  return string16(reinterpret_cast<const char16*>(res.data()),
+                  res.length() / 2);
+}
+  
+  
+base::StringPiece NetResourceProvider(int key) {
+  base::StringPiece res;
+  g_resource_data_pack->GetStringPiece(key, &res);
+  return res;
+}  
+
+base::StringPiece GfxResourceProvider(int key) {
+  base::StringPiece res;
+  g_resource_data_pack->GetStringPiece(key, &res);
+  return res;
+}  
+
+base::StringPiece GetDataResource(int resource_id) {
+
+
+  switch (resource_id) {
+	case IDR_BROKENIMAGE:
+	case IDR_TEXTAREA_RESIZER:
+    case IDR_SEARCH_CANCEL:
+    case IDR_SEARCH_CANCEL_PRESSED:
+    case IDR_SEARCH_MAGNIFIER:
+    case IDR_SEARCH_MAGNIFIER_RESULTS:
+    case IDR_MEDIA_PAUSE_BUTTON:
+    case IDR_MEDIA_PLAY_BUTTON:
+    case IDR_MEDIA_PLAY_BUTTON_DISABLED:
+    case IDR_MEDIA_SOUND_FULL_BUTTON:
+    case IDR_MEDIA_SOUND_NONE_BUTTON:
+    case IDR_MEDIA_SOUND_DISABLED:
+    case IDR_MEDIA_SLIDER_THUMB:
+    case IDR_MEDIA_VOLUME_SLIDER_THUMB:
+    case IDR_INPUT_SPEECH:
+    case IDR_INPUT_SPEECH_RECORDING:
+    case IDR_INPUT_SPEECH_WAITING:
+      return NetResourceProvider(resource_id);
+      
+    default:
+      break;
+  }
+  
+  return base::StringPiece();
+}
+
+void DidLoadPlugin(const std::string& filename) {
+}
+
+void DidUnloadPlugin(const std::string& filename) {
+}
+  
+}  // namespace webkit_glue
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_webkit_glue.h cef/libcef/browser_webkit_glue.h
--- libcef/browser_webkit_glue.h	2012-05-09 11:27:19.061674203 +0200
+++ libcef/browser_webkit_glue.h	2012-05-09 11:32:01.627658222 +0200
@@ -29,8 +29,12 @@
 // Save a bitmap image to file, providing optional alternative data in |lpBits|
 BOOL SaveBitmapToFile(HBITMAP hBmp, HDC hDC, LPCTSTR file, LPBYTE lpBits);
 #endif
-  
-#if defined(OS_MACOSX)
+ 
+#if defined(OS_LINUX)
+void InitializeDataPak();
+#endif
+
+#if defined(OS_MACOSX) 
 void InitializeDataPak();
 FilePath GetResourcesFilePath();
 #endif
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_webkit_init.cc cef/libcef/browser_webkit_init.cc
--- libcef/browser_webkit_init.cc	2012-05-09 11:27:19.088674201 +0200
+++ libcef/browser_webkit_init.cc	2012-05-09 11:32:01.627658222 +0200
@@ -42,11 +42,17 @@
   WebKit::WebRuntimeFeatures::enableDeviceMotion(false);
   WebKit::WebRuntimeFeatures::enableDeviceOrientation(false);
 
+#ifdef OS_LINUX
+    // Load only the libraries we want Desura to use
+    media::InitializeMediaLibrary(FilePath("./cefmedia/"));
+    WebKit::WebRuntimeFeatures::enableMediaPlayer(true);
+#else
   // Load libraries for media and enable the media player.
   FilePath module_path;
   WebKit::WebRuntimeFeatures::enableMediaPlayer(
       PathService::Get(base::DIR_MODULE, &module_path) &&
       media::InitializeMediaLibrary(module_path));
+#endif
 
   // Construct and initialize an appcache system for this scope.
   // A new empty temp directory is created to house any cached
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_webview_delegate_gtk.cc cef/libcef/browser_webview_delegate_gtk.cc
--- libcef/browser_webview_delegate_gtk.cc	2012-05-09 11:27:19.063674202 +0200
+++ libcef/browser_webview_delegate_gtk.cc	2012-05-09 11:32:01.628658222 +0200
@@ -10,30 +10,47 @@
 #include <gtk/gtk.h>
 
 #include "base/message_loop.h"
+#include "base/string_util.h"
+#include "net/base/net_errors.h"
+#include "third_party/WebKit/Source/WebKit/chromium/public/WebContextMenuData.h"
 #include "third_party/WebKit/Source/WebKit/chromium/public/WebCursorInfo.h"
+#include "third_party/WebKit/Source/WebKit/chromium/public/WebPopupMenu.h"
+#include "third_party/WebKit/Source/WebKit/chromium/public/WebDragData.h"
 #include "third_party/WebKit/Source/WebKit/chromium/public/WebFrame.h"
+#include "third_party/WebKit/Source/WebKit/chromium/public/WebImage.h"
+#include "third_party/WebKit/Source/WebKit/chromium/public/WebPoint.h"
 #include "third_party/WebKit/Source/WebKit/chromium/public/WebRect.h"
-#include "third_party/WebKit/Source/WebKit/chromium/public/WebString.h"
 #include "third_party/WebKit/Source/WebKit/chromium/public/WebView.h"
+#include "ui/gfx/native_widget_types.h"
 #include "ui/gfx/gtk_util.h"
 #include "ui/gfx/point.h"
-#include "webkit/glue/webcursor.h"
 #include "webkit/glue/webdropdata.h"
 #include "webkit/glue/webpreferences.h"
+#include "webkit/glue/webkit_glue.h"
 #include "webkit/glue/window_open_disposition.h"
-#include "webkit/plugins/npapi/gtk_plugin_container_manager.h"
 #include "webkit/plugins/npapi/plugin_list.h"
 #include "webkit/plugins/npapi/webplugin.h"
 #include "webkit/plugins/npapi/webplugin_delegate_impl.h"
 
+using webkit::npapi::WebPluginDelegateImpl;
+using WebKit::WebContextMenuData;
 using WebKit::WebCursorInfo;
+using WebKit::WebDragData;
+using WebKit::WebDragOperationsMask;
+using WebKit::WebExternalPopupMenu;
+using WebKit::WebExternalPopupMenuClient;
 using WebKit::WebFrame;
+using WebKit::WebImage;
 using WebKit::WebNavigationPolicy;
+using WebKit::WebPoint;
 using WebKit::WebPopupMenuInfo;
 using WebKit::WebRect;
 using WebKit::WebWidget;
 using WebKit::WebView;
 
+#define AddMenuItem(unused_0, menu, unused_1, id, label, enabled, unused_2) MenuItemCreate(menu, label, id, enabled, this)
+#define AddMenuSeparator(menu, id) MenuItemCreateSeperator(menu)
+
 namespace {
 
 enum SelectionClipboardType {
@@ -80,25 +97,299 @@
 
 // WebViewClient --------------------------------------------------------------
 
-WebWidget* BrowserWebViewDelegate::createPopupMenu(
-    const WebPopupMenuInfo& info) {
+WebExternalPopupMenu* BrowserWebViewDelegate::createExternalPopupMenu(
+    const WebPopupMenuInfo& info,
+    WebExternalPopupMenuClient* client)  {
   NOTREACHED();
   return NULL;
 }
 
-void BrowserWebViewDelegate::showContextMenu(
-    WebKit::WebFrame* frame, const WebKit::WebContextMenuData& data) {
-  NOTIMPLEMENTED();
+static gboolean MenuItemHandle(GtkWidget* menu_item, gpointer data)
+{
+  if (!data)
+    return FALSE;
+
+  BrowserWebViewDelegate* webViewDelegate = (BrowserWebViewDelegate*)data;
+  int id = GPOINTER_TO_INT(g_object_get_data(G_OBJECT(menu_item), "menu_id"));
+
+  webViewDelegate->handleContextMenu(id);
+
+  return FALSE;
+}
+
+static GtkWidget* MenuItemCreate(GtkWidget* parent_menu, const char* name, int id, bool is_enabled, BrowserWebViewDelegate* webViewDelegate)
+{
+  GtkWidget* menu_item = gtk_menu_item_new_with_label(name);
+
+  g_object_set_data(G_OBJECT(menu_item), "menu_id", (gpointer)id);
+  g_signal_connect(G_OBJECT(menu_item), "activate", G_CALLBACK(MenuItemHandle), (gpointer)webViewDelegate);
+  gtk_menu_shell_append(GTK_MENU_SHELL(parent_menu), menu_item);
+  gtk_widget_set_sensitive(menu_item, is_enabled);
+
+  gtk_widget_show(menu_item);
+
+  return menu_item;
+}
+
+static GtkWidget* MenuItemCreateSeperator(GtkWidget* parent_menu)
+{
+  GtkWidget* menu_item = gtk_menu_item_new();
+
+  gtk_menu_shell_append(GTK_MENU_SHELL(parent_menu), menu_item);
+  gtk_widget_show(menu_item);
+
+  return menu_item;
+}
+
+void BrowserWebViewDelegate::showContextMenu(WebKit::WebFrame* frame, const WebKit::WebContextMenuData& data) {
+  GtkWidget* menu = NULL;
+  GdkPoint screen_pt = { data.mousePosition.x, data.mousePosition.y };
+
+  std::list<std::wstring> label_list;
+
+  // Enable recursive tasks on the message loop so we can get updates while
+  // the context menu is being displayed.
+  bool old_state = MessageLoop::current()->NestableTasksAllowed();
+  MessageLoop::current()->SetNestableTasksAllowed(true);
+
+  int edit_flags = data.editFlags;
+  if(browser_->UIT_CanGoBack())
+    edit_flags |= MENU_CAN_GO_BACK;
+  if(browser_->UIT_CanGoForward())
+    edit_flags |= MENU_CAN_GO_FORWARD;
+
+  int type_flags = MENUTYPE_NONE;
+  if(!data.pageURL.isEmpty())
+    type_flags |= MENUTYPE_PAGE;
+  if(!data.frameURL.isEmpty())
+    type_flags |= MENUTYPE_FRAME;
+  if(!data.linkURL.isEmpty())
+    type_flags |= MENUTYPE_LINK;
+  if(data.mediaType == WebContextMenuData::MediaTypeImage)
+    type_flags |= MENUTYPE_IMAGE;
+  if(!data.selectedText.isEmpty())
+    type_flags |= MENUTYPE_SELECTION;
+  if(data.isEditable)
+    type_flags |= MENUTYPE_EDITABLE;
+  if(data.isSpellCheckingEnabled && !data.misspelledWord.isEmpty())
+    type_flags |= MENUTYPE_MISSPELLED_WORD;
+  if(data.mediaType == WebContextMenuData::MediaTypeVideo)
+    type_flags |= MENUTYPE_VIDEO;
+  if(data.mediaType == WebContextMenuData::MediaTypeAudio)
+    type_flags |= MENUTYPE_AUDIO;
+  
+  CefRefPtr<CefClient> client = browser_->GetClient();
+  CefRefPtr<CefMenuHandler> handler;
+  if (client.get())
+    handler = client->GetMenuHandler();
+
+  if (handler.get()) {
+    // Gather menu information
+    cef_handler_menuinfo_t menuInfo;
+    memset(&menuInfo, 0, sizeof(menuInfo));
+
+    CefString linkStr(std::string(data.linkURL.spec()));
+    CefString imageStr(std::string(data.srcURL.spec()));
+    CefString pageStr(std::string(data.pageURL.spec()));
+    CefString frameStr(std::string(data.frameURL.spec()));
+    CefString selectedTextStr(string16(data.selectedText));
+    CefString misspelledWordStr(string16(data.misspelledWord));
+    CefString securityInfoStr(std::string(data.securityInfo));
+    
+    menuInfo.typeFlags = type_flags;
+    menuInfo.x = screen_pt.x;
+    menuInfo.y = screen_pt.y;
+    cef_string_set(linkStr.c_str(), linkStr.length(), &menuInfo.linkUrl, false);
+    cef_string_set(imageStr.c_str(), imageStr.length(), &menuInfo.imageUrl,
+        false);
+    cef_string_set(pageStr.c_str(), pageStr.length(), &menuInfo.pageUrl, false);
+    cef_string_set(frameStr.c_str(), frameStr.length(), &menuInfo.frameUrl,
+        false);
+    cef_string_set(selectedTextStr.c_str(), selectedTextStr.length(),
+        &menuInfo.selectionText, false);
+    cef_string_set(misspelledWordStr.c_str(), misspelledWordStr.length(),
+        &menuInfo.misspelledWord, false);
+    menuInfo.editFlags = edit_flags;
+    cef_string_set(securityInfoStr.c_str(), securityInfoStr.length(),
+        &menuInfo.securityInfo, false);
+   
+
+	std::vector<std::string> customItemLabel;
+	std::vector<cef_handler_menuitem_t> customItems;
+
+
+  for (size_t x=0; x<data.customItems.size(); x++) {
+	  WebKit::WebMenuItemInfo info = data.customItems[x];
+
+	  std::string label = CefStringUTF8(info.label);
+
+		if (label.size() == 0 && info.type != WebKit::WebMenuItemInfo::Separator)
+			continue;
+
+		cef_handler_menuitem_t item;
+
+		item.action = info.action;
+
+		switch (info.type) {
+		case WebKit::WebMenuItemInfo::Option:
+			item.type = MENUITEMTYPE_OPTION;
+			break;
+
+		case WebKit::WebMenuItemInfo::CheckableOption:
+			item.type = MENUITEMTYPE_CHECKABLEOPTION;
+			break;
+
+		case WebKit::WebMenuItemInfo::Separator:
+			item.type = MENUITEMTYPE_SEPERATOR;
+			break;
+
+		case WebKit::WebMenuItemInfo::Group:
+			item.type = MENUITEMTYPE_GROUP;
+			break;
+
+		default:
+			continue;
+		}
+
+		item.enabled = info.enabled;
+		item.checked = info.checked;
+
+		customItemLabel.push_back(label);
+
+		cef_string_utf8_set(customItemLabel.back().c_str(), customItemLabel.back().size(), &item.label, 0);
+		customItems.push_back(item);
+  }
+
+    menuInfo.customSize = customItems.size();
+    menuInfo.customItems = new cef_handler_menuitem_t[menuInfo.customSize];
+  
+  for (size_t x=0; x<customItems.size(); x++) {
+    menuInfo.customItems[x] = customItems[x];
+  }
+
+    // Notify the handler that a context menu is requested
+    bool res = handler->OnBeforeMenu(browser_, menuInfo);
+	delete [] menuInfo.customItems;
+	
+	if (res)
+      goto end;
+  }
+
+  // Build the correct default context menu
+  if (type_flags &  MENUTYPE_EDITABLE) {
+    menu = gtk_menu_new();
+    AddMenuItem(browser_, menu, -1, MENU_ID_UNDO, "Undo",
+      !!(edit_flags & MENU_CAN_UNDO), label_list);
+    AddMenuItem(browser_, menu, -1, MENU_ID_REDO, "Redo",
+      !!(edit_flags & MENU_CAN_REDO), label_list);
+    AddMenuSeparator(menu, -1);
+    AddMenuItem(browser_, menu, -1, MENU_ID_CUT, "Cut",
+      !!(edit_flags & MENU_CAN_CUT), label_list);
+    AddMenuItem(browser_, menu, -1, MENU_ID_COPY, "Copy",
+      !!(edit_flags & MENU_CAN_COPY), label_list);
+    AddMenuItem(browser_, menu, -1, MENU_ID_PASTE, "Paste",
+      !!(edit_flags & MENU_CAN_PASTE), label_list);
+    AddMenuItem(browser_, menu, -1, MENU_ID_DELETE, "Delete",
+      !!(edit_flags & MENU_CAN_DELETE), label_list);
+    AddMenuSeparator(menu, -1);
+    AddMenuItem(browser_, menu, -1, MENU_ID_SELECTALL, "Select All",
+      !!(edit_flags & MENU_CAN_SELECT_ALL), label_list);
+  } else if(type_flags & MENUTYPE_SELECTION) {
+    menu = gtk_menu_new();
+    AddMenuItem(browser_, menu, -1, MENU_ID_COPY, "Copy",
+      !!(edit_flags & MENU_CAN_COPY), label_list);
+  } else if(type_flags & (MENUTYPE_PAGE | MENUTYPE_FRAME)) {
+    menu = gtk_menu_new();
+    AddMenuItem(browser_, menu, -1, MENU_ID_NAV_BACK, "Back",
+      !!(edit_flags & MENU_CAN_GO_BACK), label_list);
+    AddMenuItem(browser_, menu, -1, MENU_ID_NAV_FORWARD, "Forward",
+      !!(edit_flags & MENU_CAN_GO_FORWARD), label_list);
+    AddMenuSeparator(menu, -1);
+    AddMenuItem(browser_, menu, -1, MENU_ID_PRINT, "Print",
+      true, label_list);
+    AddMenuItem(browser_, menu, -1, MENU_ID_VIEWSOURCE, "View Source",
+      true, label_list);
+  }
+
+  for (size_t x=0; x<data.customItems.size(); x++) {
+	  WebKit::WebMenuItemInfo info = data.customItems[x];
+
+      std::string label = CefStringUTF8(info.label);
+
+		if (label.size() == 0 && info.type != WebKit::WebMenuItemInfo::Separator)
+			continue;
+
+		switch (info.type) {
+		case WebKit::WebMenuItemInfo::Option:
+			AddMenuItem(browser_, menu, -1, (cef_handler_menuid_t)(MENU_ID_CUSTOM+info.action), label.c_str(), info.enabled, label_list);
+			break;
+
+		case WebKit::WebMenuItemInfo::CheckableOption:
+			AddMenuItem(browser_, menu, -1, (cef_handler_menuid_t)(MENU_ID_CUSTOM+info.action), label.c_str(), info.enabled, label_list);
+			break;
+
+		case WebKit::WebMenuItemInfo::Separator:
+			AddMenuSeparator(menu, -1);
+			break;
+	
+		case WebKit::WebMenuItemInfo::Group:
+			AddMenuSeparator(menu, -1);
+			break;
+		}
+  }
+
+
+  if (menu)
+   gtk_menu_popup(GTK_MENU(menu), NULL, NULL, NULL, NULL, 3, gtk_get_current_event_time());
+
+end:
+  MessageLoop::current()->SetNestableTasksAllowed(old_state);
+}
+
+void BrowserWebViewDelegate::handleContextMenu(int selected_id)
+{
+    if (selected_id != 0) {
+    
+      CefRefPtr<CefClient> client = browser_->GetClient();
+      CefRefPtr<CefMenuHandler> handler;
+      if (client.get())
+        handler = client->GetMenuHandler();
+    
+      // An action was chosen
+      cef_handler_menuid_t menuId =
+          static_cast<cef_handler_menuid_t>(selected_id);
+      bool handled = false;
+      if (handler.get()) {
+        // Ask the handler if it wants to handle the action
+        handled = handler->OnMenuAction(browser_, menuId);
+      }
+
+      if(!handled) {
+        // Execute the action
+        browser_->UIT_HandleAction(menuId, browser_->GetFocusedFrame());
+      }
+
+	  if (!handled) {
+		browser_->UIT_GetWebViewHost()->webview()->performCustomContextMenuAction(menuId - MENU_ID_CUSTOM);
+	  }
+    }
 }
 
 // WebWidgetClient ------------------------------------------------------------
 
 void BrowserWebViewDelegate::show(WebNavigationPolicy policy) {
   WebWidgetHost* host = GetWidgetHost();
+  if (!host)
+  	return;
+  	
   GtkWidget* drawing_area = host->view_handle();
-  GtkWidget* window =
-      gtk_widget_get_parent(gtk_widget_get_parent(drawing_area));
-  gtk_widget_show_all(window);
+  if (!drawing_area)
+  	return;
+  	
+  GtkWidget* window = gtk_widget_get_parent(gtk_widget_get_parent(drawing_area));
+  	
+  if (window)
+  	gtk_widget_show_all(window);
 }
 
 void BrowserWebViewDelegate::didChangeCursor(const WebCursorInfo& cursor_info) {
@@ -127,10 +418,55 @@
 }
 
 WebRect BrowserWebViewDelegate::windowRect() {
-  WebWidgetHost* host = GetWidgetHost();
+  // TODO(fix)
+  // In full screen mode, this positions the webwidget 4px to the left, and 1px
+  // too high. Mouse functions on large <select>'s work fine though.
+  // In restored mode, thks positions the webwidget perfectly (with my WM at
+  // least), although mouse positions on long <select>'s are off by the offset
+  // of the webwidget (sometimes webkit draws it starting from the top of the
+  // host) - Keith
+  
+  if (WebWidgetHost* host = GetWidgetHost()) {
+    GtkWidget* drawing_area = host->view_handle();
+    
+    if (!drawing_area)
+      return WebRect();
+      
+    GtkWidget* next = gtk_widget_get_parent(drawing_area);
+    
+    if (!next)
+      return WebRect();
+      
+    gint x, x1, y, y1;
+    
+    x = drawing_area->allocation.x;
+    y = drawing_area->allocation.y + 25;
+    
+    do {
+      x += next->allocation.x; 
+      y += next->allocation.y;
+    
+      next = gtk_widget_get_parent(next);
+    } while (next && (next != browser_->UIT_GetMainWndHandle()));
+    
+    if (next) // top window
+    {
+      gtk_window_get_position(GTK_WINDOW(next), &x1, &y1);
+      x += x1;
+      y += y1;
+    }
+
+  return WebRect(x, y,
+                 drawing_area->allocation.width,
+                 drawing_area->allocation.height);
+  }
+  return WebRect();
+  
+/*  WebWidgetHost* host = GetWidgetHost();
   GtkWidget* drawing_area = host->view_handle();
   GtkWidget* vbox = gtk_widget_get_parent(drawing_area);
-  GtkWidget* window = gtk_widget_get_parent(vbox);
+//GtkWidget* window = gtk_widget_get_parent(vbox);
+  GtkWidget* window = browser_->UIT_GetMainWndHandle();
 
   gint x, y;
   gtk_window_get_position(GTK_WINDOW(window), &x, &y);
@@ -139,7 +475,7 @@
 
   return WebRect(x, y,
                  drawing_area->allocation.width,
-                 drawing_area->allocation.height);
+                 drawing_area->allocation.height);*/
 }
 
 void BrowserWebViewDelegate::setWindowRect(const WebRect& rect) {
@@ -147,24 +483,30 @@
     // TODO(port): Set the window rectangle.
   } else if (this == browser_->UIT_GetPopupDelegate()) {
     WebWidgetHost* host = GetWidgetHost();
+    if (!host)
+    	return;
+    	
     GtkWidget* drawing_area = host->view_handle();
-    GtkWidget* window =
-        gtk_widget_get_parent(gtk_widget_get_parent(drawing_area));
+    if (!drawing_area)
+      return;
+    	
+    GtkWidget* window = gtk_widget_get_parent(gtk_widget_get_parent(drawing_area));
+    if (!window)
+      return;
+    	
     gtk_window_resize(GTK_WINDOW(window), rect.width, rect.height);
     gtk_window_move(GTK_WINDOW(window), rect.x, rect.y);
   }
 }
 
 WebRect BrowserWebViewDelegate::rootWindowRect() {
-  if (WebWidgetHost* host = GetWidgetHost()) {
+  if (GtkWidget* window = browser_->UIT_GetMainWndHandle()) {
     // We are being asked for the x/y and width/height of the entire browser
     // window.  This means the x/y is the distance from the corner of the
     // screen, and the width/height is the size of the entire browser window.
     // For example, this is used to implement window.screenX and window.screenY.
-    GtkWidget* drawing_area = host->view_handle();
-    GtkWidget* window =
-        gtk_widget_get_parent(gtk_widget_get_parent(drawing_area));
     gint x, y, width, height;
+    
     gtk_window_get_position(GTK_WINDOW(window), &x, &y);
     gtk_window_get_size(GTK_WINDOW(window), &width, &height);
     return WebRect(x, y, width, height);
@@ -226,13 +568,23 @@
 
 void BrowserWebViewDelegate::ShowJavaScriptAlert(
     WebKit::WebFrame* webframe, const CefString& message) {
-  NOTIMPLEMENTED();
+	GtkWidget* dialog = gtk_message_dialog_new(
+	  GTK_WINDOW(browser_->UIT_GetMainWndHandle()), GTK_DIALOG_MODAL, GTK_MESSAGE_INFO,
+	  GTK_BUTTONS_OK, "%s", message.c_str());
+	gtk_window_set_title(GTK_WINDOW(dialog), "JavaScript Alert");
+	gtk_dialog_run(GTK_DIALOG(dialog));  // Runs a nested message loop.
+	gtk_widget_destroy(dialog);
 }
 
 bool BrowserWebViewDelegate::ShowJavaScriptConfirm(
     WebKit::WebFrame* webframe, const CefString& message) {
-  NOTIMPLEMENTED();
-  return false;
+	GtkWidget* dialog = gtk_message_dialog_new(
+	  GTK_WINDOW(browser_->UIT_GetMainWndHandle()), GTK_DIALOG_MODAL, GTK_MESSAGE_QUESTION,
+	  GTK_BUTTONS_OK_CANCEL, "%s", message.c_str());
+	gtk_window_set_title(GTK_WINDOW(dialog), "JavaScript Confirm");
+	int ret = gtk_dialog_run(GTK_DIALOG(dialog));
+	gtk_widget_destroy(dialog);
+	return (ret == GTK_RESPONSE_OK);
 }
 
 bool BrowserWebViewDelegate::ShowJavaScriptPrompt(
@@ -242,11 +594,46 @@
   return false;
 }
 
+static void parseGSList(gpointer data, gpointer user_data) {
+  if (!data || !user_data)
+    return;
+    
+  std::vector<FilePath> *file_names = (std::vector<FilePath>*)user_data;
+  
+  file_names->push_back(FilePath((char*)data));
+  g_free(data);
+}
+
 // Called to show the file chooser dialog.
 bool BrowserWebViewDelegate::ShowFileChooser(std::vector<FilePath>& file_names,
                                              const bool multi_select,
                                              const WebKit::WebString& title,
                                              const FilePath& default_file) {
-  NOTIMPLEMENTED();
-  return false;
+  GtkWidget *dialog;
+  dialog = gtk_file_chooser_dialog_new ("SelectFile",
+				      GTK_WINDOW(browser_->UIT_GetMainWndHandle()),
+				      GTK_FILE_CHOOSER_ACTION_OPEN,
+				      GTK_STOCK_CANCEL, GTK_RESPONSE_CANCEL,
+				      GTK_STOCK_OPEN, GTK_RESPONSE_ACCEPT,
+				      NULL);
+  gtk_file_chooser_set_select_multiple(GTK_FILE_CHOOSER(dialog), (gboolean)multi_select);
+  
+  if (!default_file.empty())
+    gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog), default_file.MaybeAsASCII().c_str());
+  
+  if (gtk_dialog_run(GTK_DIALOG(dialog)) == GTK_RESPONSE_ACCEPT) {
+    if (multi_select) {
+      GSList *selected_files = gtk_file_chooser_get_filenames(GTK_FILE_CHOOSER(dialog));
+      g_slist_foreach(selected_files, parseGSList, (gpointer)&file_names);
+      g_slist_free(selected_files);
+    } else {
+      file_names.push_back(FilePath(gtk_file_chooser_get_filename(GTK_FILE_CHOOSER(dialog))));
+    }
+  } else {
+    gtk_widget_destroy(dialog);
+    return false;
+  }
+  
+  gtk_widget_destroy(dialog);
+  return true;
 }
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_webview_delegate.h cef/libcef/browser_webview_delegate.h
--- libcef/browser_webview_delegate.h	2012-05-09 11:27:19.081674201 +0200
+++ libcef/browser_webview_delegate.h	2012-05-09 11:32:01.628658222 +0200
@@ -97,6 +97,9 @@
       OVERRIDE;
   virtual bool runModalBeforeUnloadDialog(
       WebKit::WebFrame* frame, const WebKit::WebString& message) OVERRIDE;
+#ifdef OS_LINUX
+  void handleContextMenu(int selected_id);
+#endif
   virtual void showContextMenu(
       WebKit::WebFrame* frame, const WebKit::WebContextMenuData& data) OVERRIDE;
   virtual void setStatusText(const WebKit::WebString& text) OVERRIDE;
@@ -251,6 +254,11 @@
 
   CefBrowserImpl* GetBrowser() { return browser_; }
 
+#if defined(OS_WIN)
+  bool WndProc(UINT message, WPARAM wparam, LPARAM lparam);
+#endif
+
+
 #if defined(OS_MACOSX)
   // Called after the external popup menu has been dismissed.
   void ClosePopupMenu();
diff '--exclude=.svn' -aurN cef.ori/libcef/browser_webview_delegate_win.cc cef/libcef/browser_webview_delegate_win.cc
--- libcef/browser_webview_delegate_win.cc	2012-05-09 11:27:19.046674203 +0200
+++ libcef/browser_webview_delegate_win.cc	2012-05-09 11:32:01.628658222 +0200
@@ -731,3 +814,18 @@
   return result;
 }
 
+bool BrowserWebViewDelegate::WndProc(UINT message, WPARAM wparam, LPARAM lparam)
+{
+  CefRefPtr<CefClient> client = browser_->GetClient();
+
+  if (!client.get())
+    return false;
+
+  CefRefPtr<CefWinEventHandler> win_handler = client->GetWinEventHandler();
+  
+  if (!win_handler.get())
+    return false;
+
+  win_handler->OnWndProc(browser_, message, wparam, lparam);
+  return false;
+}
diff '--exclude=.svn' -aurN cef.ori/libcef/cef_context.cc cef/libcef/cef_context.cc
--- libcef/cef_context.cc	2012-05-09 11:27:17.883674268 +0200
+++ libcef/cef_context.cc	2012-05-09 11:32:01.628658222 +0200
@@ -8,6 +8,7 @@
 #include "cef_thread.h"
 #include "cef_time_util.h"
 #include "cef_process.h"
+#include "cef_paths.h"
 #include "../include/cef_nplugin.h"
 
 #include "base/file_util.h"
@@ -96,6 +97,16 @@
   }
 }
 
+void UIT_RegisterFlashPlugin(const std::string& dllName)
+{
+  FilePath path;
+
+  // Register the internal Flash and PDF, if available.
+  if (cef::GetFlashPluginPath(&path, dllName.size()>0?dllName.c_str():NULL)) {
+    webkit::npapi::PluginList::Singleton()->AddExtraPluginPath(path);
+  }
+}
+
 void IOT_VisitAllCookies(CefRefPtr<CefCookieVisitor> visitor)
 {
   REQUIRE_IOT();
@@ -219,6 +230,12 @@
   _Context->process()->RunMessageLoop();
 }
 
+void CefRegisterFlashPlugin(const std::string& dllName)
+{
+  CefThread::PostTask(CefThread::UI, FROM_HERE,
+      NewRunnableFunction(UIT_RegisterFlashPlugin, dllName));
+}
+
 bool CefRegisterPlugin(const CefPluginInfo& plugin_info)
 {
   // Verify that the context is in a valid state.
diff '--exclude=.svn' -aurN cef.ori/libcef/cef_paths.cc cef/libcef/cef_paths.cc
--- libcef/cef_paths.cc	1970-01-01 01:00:00.000000000 +0100
+++ libcef/cef_paths.cc	2012-05-09 11:32:01.629658221 +0200
@@ -0,0 +1,65 @@
+// Copyright (c) 2006-2010 The Chromium Authors. All rights reserved.
+// Use of this source code is governed by a BSD-style license that can be
+// found in the LICENSE file.
+
+#include "cef_paths.h"
+#include "include/internal/cef_string.h"
+
+#include "base/command_line.h"
+#include "base/file_util.h"
+#include "base/logging.h"
+#include "base/path_service.h"
+#include "base/string_util.h"
+#include "base/sys_info.h"
+#include "chrome/common/chrome_constants.h"
+#include "chrome/common/chrome_paths_internal.h"
+#include "chrome/common/chrome_switches.h"
+
+
+namespace {
+
+// File name of the internal Flash plugin on different platforms.
+const FilePath::CharType kInternalFlashPluginFileName[] =
+#if defined(OS_MACOSX)
+    FILE_PATH_LITERAL("Flash Player Plugin for Chrome.plugin");
+#elif defined(OS_WIN)
+    FILE_PATH_LITERAL("gcswf32.dll");
+#else  // OS_LINUX, etc.
+    FILE_PATH_LITERAL("libgcflashplayer.so");
+#endif
+
+}  // namespace
+
+namespace cef {
+
+// Gets the path for internal plugins.
+bool GetInternalPluginsDirectory(FilePath* result) {
+  // The rest of the world expects plugins in the module directory.
+
+  bool res = PathService::Get(base::DIR_MODULE, result);
+  return res;
+}
+
+bool GetFlashPluginPath(FilePath* result, const char* dllName)
+{
+  FilePath cur;
+
+  if (!GetInternalPluginsDirectory(&cur))
+    return false;
+
+  if (dllName)
+	cur = cur.Append(CefStringUTF16(dllName));
+  else
+	cur = cur.Append(kInternalFlashPluginFileName);
+
+  if (!file_util::PathExists(cur))
+    return false;
+
+  *result = cur;
+  return true;
+}
+
+
+
+
+}  // namespace chrome
diff '--exclude=.svn' -aurN cef.ori/libcef/cef_paths.h cef/libcef/cef_paths.h
--- libcef/cef_paths.h	1970-01-01 01:00:00.000000000 +0100
+++ libcef/cef_paths.h	2012-05-09 11:32:01.629658221 +0200
@@ -0,0 +1,20 @@
+// Copyright (c) 2006-2010 The Chromium Authors. All rights reserved.
+// Use of this source code is governed by a BSD-style license that can be
+// found in the LICENSE file.
+
+#ifndef CEF_COMMON_CHROME_PATHS_H__
+#define CEF_COMMON_CHROME_PATHS_H__
+#pragma once
+
+#include "build/build_config.h"
+
+class FilePath;
+
+namespace cef {
+
+  bool GetInternalPluginsDirectory(FilePath* result);
+  bool GetFlashPluginPath(FilePath* result, const char* dllName);
+
+}  // namespace cef
+
+#endif  // CEF_COMMON_CHROME_PATHS_H__
diff '--exclude=.svn' -aurN cef.ori/libcef/cef_process_ui_thread.cc cef/libcef/cef_process_ui_thread.cc
--- libcef/cef_process_ui_thread.cc	2012-05-09 11:27:19.045674203 +0200
+++ libcef/cef_process_ui_thread.cc	2012-05-09 11:32:01.629658221 +0200
@@ -144,7 +144,11 @@
   // Flush any remaining messages.  This ensures that any accumulated
   // Task objects get destroyed before we exit, which avoids noise in
   // purify leak-test results.
+  //
+  // On linux this seems to dead lock if its called after gtk has stopped
+#ifndef OS_LINUX
   MessageLoop::current()->RunAllPending();
+#endif
 
   // Destroy the storage context object.
   _Context->set_storage_context(NULL);
diff '--exclude=.svn' -aurN cef.ori/libcef/cef_process_ui_thread_gtk.cc cef/libcef/cef_process_ui_thread_gtk.cc
--- libcef/cef_process_ui_thread_gtk.cc	2012-05-09 11:27:19.065674201 +0200
+++ libcef/cef_process_ui_thread_gtk.cc	2012-05-09 11:32:01.629658221 +0200
@@ -4,9 +4,10 @@
 
 #include "cef_process_ui_thread.h"
 #include "browser_impl.h"
+#include "browser_webkit_glue.h"
 
 void CefProcessUIThread::PlatformInit() {
-  
+  webkit_glue::InitializeDataPak();
 }
 
 void CefProcessUIThread::PlatformCleanUp() {
diff '--exclude=.svn' -aurN cef.ori/libcef/cef_string_map.cc cef/libcef/cef_string_map.cc
--- libcef/cef_string_map.cc	2012-05-09 11:27:19.064674202 +0200
+++ libcef/cef_string_map.cc	2012-05-09 11:32:01.629658221 +0200
@@ -30,7 +30,7 @@
   StringMap* impl = (StringMap*)map;
   StringMap::const_iterator it = impl->find(CefString(key));
   if(it == impl->end())
-    return NULL;
+    return 0;
   const CefString& val = it->second;
   return cef_string_set(val.c_str(), val.length(), value, true);
 }
@@ -43,7 +43,7 @@
   StringMap* impl = (StringMap*)map;
   DCHECK(index >= 0 && index < (int)impl->size());
   if(index < 0 || index >= (int)impl->size())
-    return NULL;
+    return 0;
   StringMap::const_iterator it = impl->begin();
   for(int ct = 0; it != impl->end(); ++it, ct++) {
     if(ct == index)
@@ -60,7 +60,7 @@
   StringMap* impl = (StringMap*)map;
   DCHECK(index >= 0 && index < (int)impl->size());
   if(index < 0 || index >= (int)impl->size())
-    return NULL;
+    return 0;
   StringMap::const_iterator it = impl->begin();
   for(int ct = 0; it != impl->end(); ++it, ct++) {
     if(ct == index) {
diff '--exclude=.svn' -aurN cef.ori/libcef/v8_impl.cc cef/libcef/v8_impl.cc
--- libcef/v8_impl.cc	2012-05-09 11:27:19.082674201 +0200
+++ libcef/v8_impl.cc	2012-05-09 11:32:01.633658222 +0200
@@ -736,7 +736,7 @@
     return NULL;
   if(!GetHandle()->IsObject()) {
     NOTREACHED();
-    return false;
+    return NULL;
   }
  
   v8::HandleScope handle_scope;
@@ -749,7 +749,7 @@
   CEF_REQUIRE_UI_THREAD(NULL);
   if(!GetHandle()->IsObject()) {
     NOTREACHED();
-    return false;
+    return NULL;
   }
 
   v8::HandleScope handle_scope;
diff '--exclude=.svn' -aurN cef.ori/libcef/webview_host.cc cef/libcef/webview_host.cc
--- libcef/webview_host.cc	2012-05-09 11:27:19.085674199 +0200
+++ libcef/webview_host.cc	2012-05-09 11:32:01.634658222 +0200
@@ -4,8 +4,9 @@
 
 #include "webview_host.h"
 
-WebViewHost::WebViewHost()
+WebViewHost::WebViewHost(BrowserWebViewDelegate* delegate)
 {
+  delegate_ = delegate;
 }
 
 #if !defined(OS_MACOSX)
diff '--exclude=.svn' -aurN cef.ori/libcef/webview_host_gtk.cc cef/libcef/webview_host_gtk.cc
--- libcef/webview_host_gtk.cc	2012-05-09 11:27:19.057674203 +0200
+++ libcef/webview_host_gtk.cc	2012-05-09 11:32:01.634658222 +0200
@@ -20,9 +20,7 @@
 
 // static
 WebViewHost* WebViewHost::Create(GtkWidget* parent_view,
-                                 const gfx::Rect& rect,
                                  BrowserWebViewDelegate* delegate,
-                                 PaintDelegate* paint_delegate,
                                  WebDevToolsAgentClient* dev_tools_client,
                                  const WebPreferences& prefs) {
   WebViewHost* host = new WebViewHost();
@@ -30,11 +28,7 @@
   host->view_ = WebWidgetHost::CreateWidget(parent_view, host);
   host->plugin_container_manager_.set_host_widget(host->view_);
 
-#if defined(WEBKIT_HAS_WEB_AUTO_FILL_CLIENT)
-  host->webwidget_ = WebView::create(delegate, NULL);
-#else
   host->webwidget_ = WebView::create(delegate);
-#endif
   host->webview()->setDevToolsAgentClient(dev_tools_client);
   prefs.Apply(host->webview());
   host->webview()->initializeMainFrame(delegate);
@@ -43,6 +37,11 @@
   return host;
 }
 
+WebViewHost::~WebViewHost() {
+  //have issue when the map gets unloaded that it causes DestoryPluginContainer to be called. Make sure we do it before we are invalid.
+  plugin_container_manager_ = webkit::npapi::GtkPluginContainerManager();
+}
+
 WebView* WebViewHost::webview() const {
   return static_cast<WebView*>(webwidget_);
 }
diff '--exclude=.svn' -aurN cef.ori/libcef/webview_host.h cef/libcef/webview_host.h
--- libcef/webview_host.h	2012-05-09 11:27:19.076674202 +0200
+++ libcef/webview_host.h	2012-05-09 11:32:01.634658222 +0200
@@ -7,6 +7,7 @@
 
 #include "base/basictypes.h"
 #include "ui/gfx/native_widget_types.h"
+#include "ui/gfx/rect.h"
 #include "webwidget_host.h"
 
 #if defined(TOOLKIT_USES_GTK)
@@ -27,18 +28,24 @@
   // The new instance is deleted once the associated NativeView is destroyed.
   // The newly created window should be resized after it is created, using the
   // MoveWindow (or equivalent) function.
+#ifdef OS_WIN
   static WebViewHost* Create(gfx::NativeView parent_view,
-                             const gfx::Rect& rect,
-                             BrowserWebViewDelegate* delegate,
-                             PaintDelegate* paint_delegate,
-                             WebKit::WebDevToolsAgentClient* devtools_client,
-                             const WebPreferences& prefs);
-
-  virtual ~WebViewHost();
-
+                                 const gfx::Rect&,
+                                 BrowserWebViewDelegate* delegate,
+                                 PaintDelegate* paint_delegate,
+								 WebKit::WebDevToolsAgentClient* dev_tools_client,
+                                 const WebPreferences& prefs);
+#else                                 
+  static WebViewHost* Create(gfx::NativeView parent_view,
+	                             BrowserWebViewDelegate* delegate,
+	                             WebKit::WebDevToolsAgentClient* devtools_client,
+	                             const WebPreferences& prefs);
+#endif
   WebKit::WebView* webview() const;
 
 #if defined(TOOLKIT_USES_GTK)
+  ~WebViewHost();
+
   // Create a new plugin parent container for a given plugin XID.
   void CreatePluginContainer(gfx::PluginWindowHandle id);
 
@@ -50,22 +57,27 @@
   }
 #elif defined(OS_MACOSX)
   void SetIsActive(bool active);
-  virtual void MouseEvent(NSEvent *);
-  virtual void SetFocus(bool enable);
 #endif
 
- protected:
-   WebViewHost();
+#ifdef OS_WIN
+ ~WebViewHost();
+#endif
 
-#if defined(OS_WIN)
+ protected:
+#ifdef OS_WIN
+  WebViewHost(BrowserWebViewDelegate* delegate);
   virtual bool WndProc(UINT message, WPARAM wparam, LPARAM lparam);
-  virtual void MouseEvent(UINT message, WPARAM wparam, LPARAM lparam);
+  void MouseEvent(UINT message, WPARAM wparam, LPARAM lparam);
 #endif
 
 #if defined(TOOLKIT_USES_GTK)
   // Helper class that creates and moves plugin containers.
   webkit::npapi::GtkPluginContainerManager plugin_container_manager_;
 #endif
+
+#ifdef OS_WIN
+  BrowserWebViewDelegate* delegate_;
+ #endif
 };
 
 #endif  // _WEBVIEW_HOST_H
diff '--exclude=.svn' -aurN cef.ori/libcef/webview_host_win.cc cef/libcef/webview_host_win.cc
--- libcef/webview_host_win.cc	2012-05-09 11:27:19.089674201 +0200
+++ libcef/webview_host_win.cc	2012-05-09 11:32:01.634658222 +0200
@@ -17,13 +17,13 @@
 static const wchar_t kWindowClassName[] = L"WebViewHost";
 
 /*static*/
-WebViewHost* WebViewHost::Create(HWND parent_view,
+WebViewHost* WebViewHost::Create(gfx::NativeView parent_view,
                                  const gfx::Rect&,
                                  BrowserWebViewDelegate* delegate,
                                  PaintDelegate* paint_delegate,
                                  WebDevToolsAgentClient* dev_tools_client,
                                  const WebPreferences& prefs) {
-  WebViewHost* host = new WebViewHost();
+  WebViewHost* host = new WebViewHost(delegate);
 
   if (!paint_delegate) {
     static bool registered_class = false;
@@ -65,6 +65,11 @@
 }
 
 bool WebViewHost::WndProc(UINT message, WPARAM wparam, LPARAM lparam) {
+
+  if (delegate_->WndProc(message, wparam, lparam)){
+    return false;
+  }
+
   switch (message) {
   case WM_SETFOCUS:
     // Set the current WebViewHost in case a drag action is started before mouse
diff '--exclude=.svn' -aurN cef.ori/libcef/webwidget_host_gtk.cc cef/libcef/webwidget_host_gtk.cc
--- libcef/webwidget_host_gtk.cc	2012-05-09 11:27:19.078674202 +0200
+++ libcef/webwidget_host_gtk.cc	2012-05-09 11:32:01.635658222 +0200
@@ -20,6 +22,11 @@
 #include "third_party/WebKit/Source/WebKit/chromium/public/WebScreenInfo.h"
 #include "third_party/WebKit/Source/WebKit/chromium/public/WebSize.h"
 
+#ifndef NDEBUG
+	#define PAUSE_DEBUGGER() asm("int $3")#else
+	#define PAUSE_DEBUGGER()
+#endif
+
 using WebKit::WebInputEventFactory;
 using WebKit::WebKeyboardEvent;
 using WebKit::WebMouseEvent;
@@ -64,8 +71,24 @@
   // our GtkDrawingAreaContainer here, for the reasons mentioned above.
   static GtkWidget* CreateNewWidget(GtkWidget* parent_view,
                                     WebWidgetHost* host) {
+    if(!parent_view || !host)
+      return NULL;
+     
     GtkWidget* widget = gtk_fixed_new();
     gtk_fixed_set_has_window(GTK_FIXED(widget), true);
+    
+    GdkColor black, green;
+	gdk_color_parse("black", &black);
+	gdk_color_parse("green", &green);
+    
+#if defined(NDEBUG)
+    gtk_widget_modify_bg(widget, GTK_STATE_NORMAL, &black);
+#else
+    gtk_widget_modify_bg(widget, GTK_STATE_NORMAL, &green);
+#endif
+
+    // Allow the browser window to be resized freely.
+    gtk_widget_set_size_request(widget, 0, 0);
 
     gtk_box_pack_start(GTK_BOX(parent_view), widget, TRUE, TRUE, 0);
 
@@ -107,6 +131,72 @@
 
     g_object_set_data(G_OBJECT(widget), kWebWidgetHostKey, host);
     return widget;
+    
+
+// the following is newer code from Chrome's implementation 
+// and requires some extras, including the two commented out
+// includes at the top. Should work though.    
+/*    GtkWidget* widget = gtk_preserve_window_new();
+    
+    GdkColor blackCol;
+	gdk_color_parse("black", &blackCol);
+	GdkColor greenCol;
+	gdk_color_parse("green", &greenCol);
+    
+#if defined(NDEBUG)
+    gtk_widget_modify_bg(widget, GTK_STATE_NORMAL, &blackCol);
+#else
+    gtk_widget_modify_bg(widget, GTK_STATE_NORMAL, &greenCol);
+#endif
+    // Allow the browser window to be resized freely.
+    gtk_widget_set_size_request(widget, 0, 0);
+
+    gtk_widget_add_events(widget, GDK_EXPOSURE_MASK |
+                                  GDK_POINTER_MOTION_MASK |
+                                  GDK_BUTTON_PRESS_MASK |
+                                  GDK_BUTTON_RELEASE_MASK |
+                                  GDK_KEY_PRESS_MASK |
+                                  GDK_KEY_RELEASE_MASK |
+                                  GDK_FOCUS_CHANGE_MASK |
+                                  GDK_ENTER_NOTIFY_MASK |
+                                  GDK_LEAVE_NOTIFY_MASK);
+    GTK_WIDGET_SET_FLAGS(widget, GTK_CAN_FOCUS);
+
+    g_signal_connect(widget, "size-request",
+                     G_CALLBACK(&HandleSizeRequest), host);
+    g_signal_connect(widget, "size-allocate",
+                     G_CALLBACK(&HandleSizeAllocate), host);
+    g_signal_connect(widget, "configure-event",
+                     G_CALLBACK(&HandleConfigure), host);
+    g_signal_connect(widget, "expose-event",
+                     G_CALLBACK(&HandleExpose), host);
+    g_signal_connect(widget, "destroy",
+                     G_CALLBACK(&HandleDestroy), host);
+    g_signal_connect(widget, "key-press-event",
+                     G_CALLBACK(&HandleKeyPress), host);
+    g_signal_connect(widget, "key-release-event",
+                     G_CALLBACK(&HandleKeyRelease), host);
+    g_signal_connect(widget, "focus",
+                     G_CALLBACK(&HandleFocus), host);
+    g_signal_connect(widget, "focus-in-event",
+                     G_CALLBACK(&HandleFocusIn), host);
+    g_signal_connect(widget, "focus-out-event",
+                     G_CALLBACK(&HandleFocusOut), host);
+    g_signal_connect(widget, "button-press-event",
+                     G_CALLBACK(&HandleButtonPress), host);
+    g_signal_connect(widget, "button-release-event",
+                     G_CALLBACK(&HandleButtonRelease), host);
+    g_signal_connect(widget, "motion-notify-event",
+                     G_CALLBACK(&HandleMotionNotify), host);
+
+    // Connect after so that we are called after the handler installed by the
+    // TabContentsView which handles zoom events.
+    g_signal_connect_after(widget, "scroll-event",
+                           G_CALLBACK(HandleScroll), host);
+
+    g_object_set_data(G_OBJECT(widget), kWebWidgetHostKey, host);
+
+    return widget;*/
   }
 
  private:
@@ -286,12 +374,35 @@
 WebWidgetHost* WebWidgetHost::Create(GtkWidget* parent_view,
                                      WebWidgetClient* client,
                                      PaintDelegate* paint_delegate) {
+  if (!parent_view || !client)
+    return NULL;
+    
+  GtkWidget* popupwindow = gtk_window_new(GTK_WINDOW_POPUP);
+  GtkWidget* vbox = gtk_vbox_new(FALSE, 0);
+  
   WebWidgetHost* host = new WebWidgetHost();
-  host->view_ = CreateWidget(parent_view, host);
+
+  host->view_ = CreateWidget(vbox, host);
   host->webwidget_ = WebPopupMenu::create(client);
+  
+  gtk_container_add(GTK_CONTAINER(popupwindow), vbox);
+
   // We manage our own double buffering because we need to be able to update
   // the expose area in an ExposeEvent within the lifetime of the event handler.
   gtk_widget_set_double_buffered(GTK_WIDGET(host->view_), false);
+  
+  // Grab all input to the test shell and funnel it to the popup.
+  // The popup will detect if mouseclicks are outside its bounds and destroy
+  // itself if so. Clicks that are outside the test_shell window will destroy
+  // the popup by taking focus away from the main window.
+  gtk_grab_add(host->view_);
+
+	GdkGeometry geom;
+	geom.min_width = 1;
+	geom.min_height = 1;
+
+	gtk_window_set_geometry_hints(GTK_WINDOW(popupwindow), GTK_WIDGET(popupwindow),
+		   &geom, GDK_HINT_MIN_SIZE);
 
   return host;
 }
@@ -301,7 +412,7 @@
 
   UpdatePaintRect(damaged_rect);
 
-  if (!g_handling_expose) {
+  if (view_ && !g_handling_expose) {
     gtk_widget_queue_draw_area(GTK_WIDGET(view_), damaged_rect.x(),
         damaged_rect.y(), damaged_rect.width(), damaged_rect.height());
   }
@@ -344,12 +455,17 @@
   g_object_set_data(G_OBJECT(view_), kWebWidgetHostKey, NULL);
   g_signal_handlers_disconnect_matched(view_,
       G_SIGNAL_MATCH_DATA, 0, 0, NULL, NULL, this);
-  webwidget_->close();
+      
+  if (webwidget_)
+    webwidget_->close();
 }
 
 void WebWidgetHost::Resize(const gfx::Size &newsize) {
+  // The pixel buffer backing us is now the wrong size
+  canvas_.reset();
   logical_size_ = newsize;
-  SetSize(newsize.width(), newsize.height());
+  //SetSize(newsize.width(), newsize.height());
+  webwidget_->resize(newsize); // TEST?
 }
 
 void WebWidgetHost::Paint() {
diff '--exclude=.svn' -aurN cef.ori/libcef_dll/cpptoc/domdocument_cpptoc.cc cef/libcef_dll/cpptoc/domdocument_cpptoc.cc
--- libcef_dll/cpptoc/domdocument_cpptoc.cc	2012-05-09 11:27:16.242674362 +0200
+++ libcef_dll/cpptoc/domdocument_cpptoc.cc	2012-05-09 11:32:01.636658222 +0200
@@ -110,7 +110,7 @@
 {
   DCHECK(self);
   if(!self)
-    return NULL;
+    return 0;
 
   return CefDOMDocumentCppToC::Get(self)->HasSelection();
 }
@@ -134,7 +134,7 @@
 {
   DCHECK(self);
   if(!self)
-    return NULL;
+    return 0;
 
   return CefDOMDocumentCppToC::Get(self)->GetSelectionStartOffset();
 }
@@ -158,7 +158,7 @@
 {
   DCHECK(self);
   if(!self)
-    return NULL;
+    return 0;
 
   return CefDOMDocumentCppToC::Get(self)->GetSelectionEndOffset();
 }
diff '--exclude=.svn' -aurN cef.ori/libcef_dll/ctocpp/browser_ctocpp.h cef/libcef_dll/ctocpp/browser_ctocpp.h
--- libcef_dll/ctocpp/browser_ctocpp.h	2012-05-09 11:27:16.668674338 +0200
+++ libcef_dll/ctocpp/browser_ctocpp.h	2012-05-09 11:32:01.641658222 +0200
@@ -55,6 +55,10 @@
   virtual void StopFinding(bool clearSelection) OVERRIDE;
   virtual double GetZoomLevel() OVERRIDE;
   virtual void SetZoomLevel(double zoomLevel) OVERRIDE;
+#ifndef IGNORE_DESURA
+  virtual void InspectElement(int x, int y) OVERRIDE; 
+  virtual void MouseWheelEvent(int x, int y, int delta, unsigned int flags) OVERRIDE;
+#endif
   virtual void ShowDevTools() OVERRIDE;
   virtual void CloseDevTools() OVERRIDE;
   virtual bool IsWindowRenderingDisabled() OVERRIDE;
diff '--exclude=.svn' -aurN cef.ori/libcef_dll/ctocpp/frame_ctocpp.h cef/libcef_dll/ctocpp/frame_ctocpp.h
--- libcef_dll/ctocpp/frame_ctocpp.h	2012-05-09 11:27:16.683674337 +0200
+++ libcef_dll/ctocpp/frame_ctocpp.h	2012-05-09 11:32:01.663658220 +0200
@@ -55,6 +55,11 @@
   virtual CefString GetName() OVERRIDE;
   virtual CefString GetURL() OVERRIDE;
   virtual CefRefPtr<CefBrowser> GetBrowser() OVERRIDE;
+#ifndef IGNORE_DESURA
+  virtual void ZoomIn() OVERRIDE;
+  virtual void ZoomOut() OVERRIDE;
+  virtual void ZoomNormal() OVERRIDE;
+#endif
   virtual void VisitDOM(CefRefPtr<CefDOMVisitor> visitor) OVERRIDE;
 };
 
diff '--exclude=.svn' -aurN cef.ori/libcef_dll/ctocpp/v8value_ctocpp.cc cef/libcef_dll/ctocpp/v8value_ctocpp.cc
--- libcef_dll/ctocpp/v8value_ctocpp.cc	2012-05-09 11:27:16.683674337 +0200
+++ libcef_dll/ctocpp/v8value_ctocpp.cc	2012-05-09 11:32:01.666658218 +0200
@@ -297,7 +297,7 @@
 CefRefPtr<CefV8Value> CefV8ValueCToCpp::GetValue(const CefString& key)
 {
   if(CEF_MEMBER_MISSING(struct_, get_value_bykey))
-    return false;
+    return NULL;
 
   cef_v8value_t* valueStruct = struct_->get_value_bykey(struct_,
       key.GetStruct());
@@ -309,7 +309,7 @@
 CefRefPtr<CefV8Value> CefV8ValueCToCpp::GetValue(int index)
 {
   if(CEF_MEMBER_MISSING(struct_, get_value_byindex))
-    return false;
+    return NULL;
 
   cef_v8value_t* valueStruct = struct_->get_value_byindex(struct_, index);
   if(valueStruct)
@@ -363,7 +363,7 @@
 CefRefPtr<CefBase> CefV8ValueCToCpp::GetUserData()
 {
   if(CEF_MEMBER_MISSING(struct_, get_user_data))
-    return false;
+    return NULL;
 
   cef_base_t* baseStruct = struct_->get_user_data(struct_);
   if(baseStruct)
@@ -393,7 +393,7 @@
 CefRefPtr<CefV8Handler> CefV8ValueCToCpp::GetFunctionHandler()
 {
   if(CEF_MEMBER_MISSING(struct_, get_function_handler))
-    return false;
+    return NULL;
 
   cef_v8handler_t* handlerStruct = struct_->get_function_handler(struct_);
   if(handlerStruct)
diff '--exclude=.svn' -aurN cef.ori/libcef_dll/version.h cef/libcef_dll/version.h
--- libcef_dll/version.h	1970-01-01 01:00:00.000000000 +0100
+++ libcef_dll/version.h	2012-05-09 11:32:01.667658219 +0200
@@ -0,0 +1,11 @@
+// This file is generated by the make_version_header.py tool.
+#ifndef _VERSION_H
+#define _VERSION_H
+
+#define SVN_REVISION 1001
+#define COPYRIGHT_YEAR 2011
+
+#define DO_MAKE_STRING(p) #p
+#define MAKE_STRING(p) DO_MAKE_STRING(p)
+
+#endif
diff '--exclude=.svn' -aurN cef.ori/patch/patch.cfg cef/patch/patch.cfg
--- patch/patch.cfg	2012-05-09 11:27:15.411674409 +0200
+++ patch/patch.cfg	2012-05-09 11:32:01.667658219 +0200
@@ -6,4 +6,8 @@
   'build' : '../build/',
   # http://codereview.chromium.org/6730028/
   'base' : '../base/',
+  'webkit' : '../third_party/WebKit/Source/WebCore/',
+  'root' : '../',
+  'resources' : '../',
+  'desura': '../',
 }
diff '--exclude=.svn' -aurN cef.ori/patch/patches/desura.patch cef/patch/patches/desura.patch
--- patch/patches/desura.patch	1970-01-01 01:00:00.000000000 +0100
+++ patch/patches/desura.patch	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,27 @@
+Index: net/proxy/proxy_service.cc
+===================================================================
+--- net/proxy/proxy_service.cc	(revision 91424)
++++ net/proxy/proxy_service.cc	(working copy)
+@@ -478,7 +478,7 @@
+   DCHECK(proxy_config_service);
+ 
+   if (!ProxyResolverFactoryForSystem::IsSupported()) {
+-    LOG(WARNING) << "PAC support disabled because there is no "
++    DLOG(WARNING) << "PAC support disabled because there is no "
+                     "system implementation";
+     return CreateWithoutProxyResolver(proxy_config_service, net_log);
+   }
+Index: net/ocsp/nss_ocsp.cc
+===================================================================
+--- net/ocsp/nss_ocsp.cc	(revision 91424)
++++ net/ocsp/nss_ocsp.cc	(working copy)
+@@ -578,7 +578,7 @@
+   net::URLRequestContext* request_context = g_request_context;
+   pthread_mutex_unlock(&g_request_context_lock);
+   if (request_context == NULL) {
+-    LOG(ERROR) << "No URLRequestContext for OCSP handler.";
++    DLOG(ERROR) << "No URLRequestContext for OCSP handler.";
+     // The application failed to call SetURLRequestContextForOCSP, so we
+     // can't create and use net::URLRequest.  PR_NOT_IMPLEMENTED_ERROR is not an
+     // accurate error code for this error condition, but is close enough.
+
diff '--exclude=.svn' -aurN cef.ori/patch/patches/resources.patch cef/patch/patches/resources.patch
--- patch/patches/resources.patch	1970-01-01 01:00:00.000000000 +0100
+++ patch/patches/resources.patch	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,14 @@
+Index: tools/grit/resource_ids
+===================================================================
+--- tools/grit/resource_ids	(revision 91424)
++++ tools/grit/resource_ids	(working copy)
+@@ -41,6 +41,9 @@
+   "webkit/tools/test_shell/test_shell_resources.grd": {
+     "includes": [5000],
+   },
++  "cef/cef_resources.grd": {
++    "includes": [5000],
++  },
+   "ui/resources/ui_resources.grd": {
+     "includes": [5500],
+   },
diff '--exclude=.svn' -aurN cef.ori/patch/patches/root.patch cef/patch/patches/root.patch
--- patch/patches/root.patch	1970-01-01 01:00:00.000000000 +0100
+++ patch/patches/root.patch	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,12 @@
+Index: base/message_loop.h
+===================================================================
+--- base/message_loop.h	(revision 91424)
++++ base/message_loop.h	(working copy)
+@@ -671,7 +671,6 @@
+   // Returns the MessageLoopForIO of the current thread.
+   static MessageLoopForIO* current() {
+     MessageLoop* loop = MessageLoop::current();
+-    DCHECK_EQ(MessageLoop::TYPE_IO, loop->type());
+     return static_cast<MessageLoopForIO*>(loop);
+   }
+ 
diff '--exclude=.svn' -aurN cef.ori/patch/patches/webkit.patch cef/patch/patches/webkit.patch
--- patch/patches/webkit.patch	1970-01-01 01:00:00.000000000 +0100
+++ patch/patches/webkit.patch	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,95 @@
+Index: bindings/v8/custom/V8DOMWindowCustom.cpp
+===================================================================
+--- bindings/v8/custom/V8DOMWindowCustom.cpp	(revision 90274)
++++ bindings/v8/custom/V8DOMWindowCustom.cpp	(working copy)
+@@ -450,7 +450,12 @@
+ 
+     // FIXME: Handle exceptions properly.
+     String urlString = toWebCoreStringWithNullOrUndefinedCheck(args[0]);
++#if 0 //DESURA
+     AtomicString frameName = (args[1]->IsUndefined() || args[1]->IsNull()) ? "_blank" : AtomicString(toWebCoreString(args[1]));
++#else
++	AtomicString frameName = (args[1]->IsUndefined() || args[1]->IsNull()) ? "_self" : AtomicString(toWebCoreString(args[1]));
++#endif
++
+     String windowFeaturesString = toWebCoreStringWithNullOrUndefinedCheck(args[2]);
+ 
+     RefPtr<DOMWindow> openedWindow = impl->open(urlString, frameName, windowFeaturesString, activeWindow, firstWindow);
+Index: html/HTMLAnchorElement.cpp
+===================================================================
+--- html/HTMLAnchorElement.cpp	(revision 90274)
++++ html/HTMLAnchorElement.cpp	(working copy)
+@@ -296,7 +296,10 @@
+ 
+ String HTMLAnchorElement::target() const
+ {
+-    return getAttribute(targetAttr);
++    String res = getAttribute(targetAttr); 
++    if (res == "_blank")
++        res = "_self";
++    return res;
+ }
+ 
+ String HTMLAnchorElement::hash() const
+Index: html/HTMLViewSourceDocument.cpp
+===================================================================
+--- html/HTMLViewSourceDocument.cpp	(revision 90274)
++++ html/HTMLViewSourceDocument.cpp	(working copy)
+@@ -317,9 +317,20 @@
+         classValue = "webkit-html-attribute-value webkit-html-external-link";
+     else
+         classValue = "webkit-html-attribute-value webkit-html-resource-link";
++#if 0 //DESURA
+     attrs->addAttribute(Attribute::createMapped(classAttr, classValue));
+     attrs->addAttribute(Attribute::createMapped(targetAttr, "_blank"));
+     attrs->addAttribute(Attribute::createMapped(hrefAttr, url));
++#else
++	PassRefPtr<Attribute> att = Attribute::createMapped(targetAttr, "_self");
++
++	if (att->value() == "_blank")
++		att->setValue("_self");
++
++	attrs->addAttribute(Attribute::createMapped(classAttr, classValue));
++	attrs->addAttribute(att);
++    attrs->addAttribute(Attribute::createMapped(hrefAttr, url));
++#endif
+     anchor->setAttributeMap(attrs.release());
+     m_current->parserAddChild(anchor);
+     anchor->attach();
+Index: page/ContextMenuController.cpp
+===================================================================
+--- page/ContextMenuController.cpp	(revision 90274)
++++ page/ContextMenuController.cpp	(working copy)
+@@ -150,7 +150,8 @@
+     m_contextMenu = m_client->customizeMenu(m_contextMenu.release());
+ #else
+     PlatformMenuDescription customMenu = m_client->getCustomMenuFromDefaultItems(m_contextMenu.get());
+-    m_contextMenu->setPlatformDescription(customMenu);
++	if (m_contextMenu.get())
++        m_contextMenu->setPlatformDescription(customMenu);
+ #endif
+     event->setDefaultHandled();
+ }
+Index: svg/SVGAElement.cpp
+===================================================================
+--- svg/SVGAElement.cpp	(revision 90274)
++++ svg/SVGAElement.cpp	(working copy)
+@@ -175,6 +175,7 @@
+                     return;
+             }
+ 
++#if 0 //Desura
+             // FIXME: Why does the SVG anchor element have this special logic
+             // for middle click that the HTML anchor element does not have?
+             // Making a middle click open a link in a new window or tab is
+@@ -186,7 +186,9 @@
+             // helpful.
+             if (target.isEmpty())
+                 target = (fastGetAttribute(XLinkNames::showAttr) == "new") ? "_blank" : "_self";
+-
++#else
++			String target = "_self";
++#endif
+             handleLinkClick(event, document(), url, target);
+             return;
+         }
diff '--exclude=.svn' -aurN cef.ori/resources/AHEM____.TTF cef/resources/AHEM____.TTF
--- resources/AHEM____.TTF	1970-01-01 01:00:00.000000000 +0100
+++ resources/AHEM____.TTF	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,23 @@
+       0OS/2xPJ  8   `cmapF  l  rgasp  	  0   glyfIt    dheadN      6hhea
+      $hmtx  }    loca u'"  &D  maxp  	      name~  (0  hpost  .       BQg_< 	    o_Y    -I  8               8                                                           2   	          H        W3C  @   8      @            }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  L          & 
+                                                                       	   
+                        ! " # $ % & ' ( ) * + , - . / 0 1 2 3 4 5 6 7 8 9 : ; < = > ? @ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z [ \ ] ^ _ `   a b c d e f g h i j k l m n o p q r s t u v w x y z { | } ~                                                                                                      &   N @   & ~ 1Sx     " & 0 : D!"!&"""""""+"H"`"e"%     ( 1Rx       & 0 9 D!"!&"""""""+"H"`"d"%   |X?    >*      $      J                                                                                                        a b  c  d        e     f      g    i h j l k m  n p o q r t s u v  w y x z | {   ~ }                     &   N @   & ~ 1Sx     " & 0 : D!"!&"""""""+"H"`"e"%     ( 1Rx       & 0 9 D!"!&"""""""+"H"`"d"%   |X?    >*      $      J                                                                                                        a b  c  d        e     f      g    i h j l k m  n p o q r t s u v  w y x z | {   ~ }                        }  k     3!%!!} }&   8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8     1!!    8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!            !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!      8    !!          " 0 > L Z h v         ,:HVdr(6DR`n|$2@N\jx .<JXdr(6DR`n|$2@N\jx .<JXft *88FTbp~	
+		&	4	B	P	^	l	z									
+
+
+"
+0
+>
+L
+Z
+h
+v
+
+
+
+
+
+
+
+
+,:HVdr(6DR`n|$2   J                                                                                                                                    	    	    	    	     	    	    	    	     	    	   M o s t   c h a r a c t e r s   a r e   t h e   e m   s q u a r e ,   e x c e p t   & E A c u t e   a n d   " p " ,   w h i c h   s h o w   a s c e n t / d e s c e n t   f r o m   t h e   b a s e l i n e .   U s e f u l   f o r   t e s t i n g   c o m p o s i t i o n   s y s t e m s .   P r o d u c e d   b y   T o d d   F a h r n e r   f o r   t h e   C S S   S a m u r a i ' s   b r o w s e r   t e s t i n g . A h e m R e g u l a r V e r s i o n   1 . 1   A h e m A h e m V e r s i o n   1 . 1 A h e mMost characters are the em square, except &EAcute and "p", which show ascent/descent from the baseline. Useful for testing composition systems. Produced by Todd Fahrner for the CSS Samurai's browser testing.AhemRegularVersion 1.1 AhemAhemVersion 1.1AhemAhemRegularAhem M o s t   c h a r a c t e r s   a r e   t h e   e m   s q u a r e ,   e x c e p t   & E A c u t e   a n d   " p " ,   w h i c h   s h o w   a s c e n t / d e s c e n t   f r o m   t h e   b a s e l i n e .   U s e f u l   f o r   t e s t i n g   c o m p o s i t i o n   s y s t e m s .   P r o d u c e d   b y   T o d d   F a h r n e r   f o r   t h e   C S S   S a m u r a i ' s   b r o w s e r   t e s t i n g . A h e m R e g u l a r V e r s i o n   1 . 1   A h e m A h e m V e r s i o n   1 . 1 A h e m A h e m R e g u l a r A h e m       {                               	                        ! " # $ % & ' ( ) * + , - . / 0 1 2 3 4 5 6 7 8 9 : ; < = > ? @ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z [ \ ] ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z { | } ~                                                                                                                       NULLHTDEL        
\ Kein Zeilenumbruch am Dateiende.
diff '--exclude=.svn' -aurN cef.ori/resources/cef.ico cef/resources/cef.ico
--- resources/cef.ico	1970-01-01 01:00:00.000000000 +0100
+++ resources/cef.ico	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,19 @@
+                     (  n  00                >      h    00     %  N!           F       h  W  (       @                                                                                  wwwwwwwwwwwwwwwpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxwwwwwwwwwwwwwxpxpxDDDDDDDDD@    pxDDDDDDDDDHpxDDDDDDDDDHpxDDDDDDDDDDDDDDpxpwwwwwwwwwwwwwwwp                                                                                                                                (                                                                                 wwwwwwwpxpxpxpxpxpxpxpxwwwwwwpxDDDpxDDDDDDpxpwwwwwwww                                                                (   0   `                             qj {r     R' Q' P' H# S$ S% R& S& R& R' hC W! V" V" U# U$ iP Z Z Y X  X  ^ ] ] [ \ a ` ` _ g g d c l
+ k i i h i e) P b  b b t s _ [ [ c r v p b q o p x
+ n	 h	 w o t y" }' , 3 E @ U |  s  q  f  c  b  c  t u t r j e c c ] [ \ u v t u t e ] \ v u v u q n o \ v w u v u w v w w v w x	 x
+ y z z z { y w  t t ' ( , , - - . 0 0 0 0 1 3 1 6 7 8 8 8 : = > = @ ? B D E I I I S ^             Fp cq  sss ppp iii aaa ``` ___ ]]] [[[ YYY XXX                                                                                                                                                                                                                                                                     	
+! %%$$"#"#"#*+()''&&??<=9;7A63[4]5mm]5\]m]mm5\mm5555555\\\5\\\5m\55\\5ed:cOXY/P.Z0.0.QR00/ZPP0000000/0PPZR.BI@/DE0, CWkV21TSav^8{|}>qooggggggg1`_fhsnHK{JLpGl-FjNw~ytMMMMMMUbbrrrrrxxxxxxxxrriUMMMMMMMMMUuzt                                                                                                                                                                                                                                                                                                 (       @                             ~r     YRO M" M" M" O$ S( S) xH0 ~L3 wG0 wH0 rE. xI1 YB \TP XRO K N! O" N" N" O$ xI0 pE. ZSO h: lA j@ s z B  @  i7 q r YSO b_] F  E  C  D  E  C  n5 l6 f> n s [TO L  I  J  I  s- r. p0 o1 j _ k l m ZTO Y  K  I w* v, h i i  Y  S  {$ z& x' e f m  k  l  m  n  o  n  j  m  k  q } $ * * 7 ? D ; @ Q b c b b o  f  q r x    { z { z u              !  $ ! & ' * + - * / / 3 3 5 6 5 7 7 8 ; = ? 7 V p  ^][                       .j   ttt ```                                                                                                                                                                                                                                                                                         		
+&1"$.#%-0%:?%9>%8=%7;EG@DF@MO@LN2Kh2\g2]f2[I3')+*+)))*))()*+++,6J!54 CBAjYPQTVTSkllZTTXRTUiHceWda/ iu`_<bmt^}zy|yx~{|yvrrwsqpon                                                                         (                                        |WR  Q3 O1 b sP? Q2 Q2 Y9 ^G  `E  cE bE   o7 f@ gD eD     b c c d c d d s  x( > zZ   g  x $ & * + + , - - / 0 4 6 I                        ~~~ }}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 PPPPPPPPPPPPPPPPPKMNNNNNNNNNNOLO	O&:
+OJHHGGGGGGGGHI
+OJEEEEEEEEEEFCOJEEEEEEEEEEFCOJEEEEEEEEEEFDOJEFEEEEEEEEEBO%JEEEEEEEEEFFBOJJIIIIJIIIIJJO(@>=77A779?<8;$O' "!)O6530./21+*-,4#4PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP                        (   0   `                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'H#P'Q'Q'Q'Q'      Q&R&R&R'R&R&R&R&R&Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'R'      R&S&      S%S$      U$U#      V"V"      W!X       YX       ZZ      \[      ]]      ^_      ``      aa      aa      aa      aa      aa      aa      aa      cc      dd      gg      gg      gg      hi   ii   !kk   "l
+l
+   "n	n	   "op   "pq   !rw   c_][\[\\\[[\\\\\[[\\[[[[[[[[[[[[[[[\[[[[[[\]bt   ef ecbc b cbb bb b c bbbcc c bbbbbbbbbc c cc b o@h	by"}'be)qjiPtt   jnrstutuwuvy{z{zx
+vwwuuuuuuuttvvvwvE|yUu{rFpcq3w      oyS^EDIID:BI638?@=>>=======8,00-.(',0-0178P,1q   J   w 1q vzx	vs s s s s s tttuuuuuwwwwwwwwuuuts s s s s s s s s twx
+v` W                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (       @                                                                                                                                                                                                                                                                                                                                                                                                     ^                                                                                       i   G >:98889:::::::::::::::::::::i2	   ,KS(O$N!N!N!N!N"M"M"M"M"M"M"M"M"M"M"M"M"M"M"M"M"N"M"M"O$S)O"   1lAs#   -j@z
+   +h:s	    +i7r
+    +l6q
+    +n5n
+    +o1m    +p0l    *r.k    #r.k    "s-j    "v,i    "w*h    "x'f    "z&e    "{$b    "$b    "*c    "}7   "Y L F C E D E C C C D C C E C C D E E E C I S @ J I B IK Y    $f k m k n n n m qrrqn n m m l n o o i @bj QDf>.j~ro    n *V=;?73?//87566-&*'!+3$357_;xh   t bx}{zz
+|z	y
+|}}~{|z	ys s yt t { } |m                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (                                                                                      
+      k                                       {   OO&F#C!C!C!C!C!C!C!C!C!C!A E$R(   prE+   pqD)   ptF'   pwH'   pzI&   p}L%   pN%   pM!   p}c>   pcdcdddcbccx(s o7|WRzW   Ry*$1mp   	                                                                                                                                 :                          
\ Kein Zeilenumbruch am Dateiende.
diff '--exclude=.svn' -aurN cef.ori/resources/cef.rc cef/resources/cef.rc
--- resources/cef.rc	1970-01-01 01:00:00.000000000 +0100
+++ resources/cef.rc	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,140 @@
+//Microsoft Visual C++ generated resource script.
+//
+#include "tools/test_shell/resource.h"
+
+#define APSTUDIO_READONLY_SYMBOLS
+/////////////////////////////////////////////////////////////////////////////
+//
+// Generated from the TEXTINCLUDE 2 resource.
+//
+#define APSTUDIO_HIDDEN_SYMBOLS
+#include "windows.h"
+#undef APSTUDIO_HIDDEN_SYMBOLS
+/////////////////////////////////////////////////////////////////////////////
+#undef APSTUDIO_READONLY_SYMBOLS
+
+#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_ENU)
+LANGUAGE 9, 1
+#pragma code_page(1252)
+
+/////////////////////////////////////////////////////////////////////////////
+//
+// Icon
+//
+
+// Icon with lowest ID value placed first to ensure application icon
+// remains consistent on all systems.
+
+IDI_TESTSHELL           ICON         "test_shell.ico"
+IDI_SMALL               ICON         "small.ico"
+
+IDR_AHEM_FONT           BINDATA      "AHEM____.TTF"
+
+
+/////////////////////////////////////////////////////////////////////////////
+//
+// Menu
+//
+
+IDC_TESTSHELL MENU 
+BEGIN
+    POPUP "&File"
+    BEGIN
+        MENUITEM "E&xit",                IDM_EXIT
+    END
+    POPUP "&Debug"
+    BEGIN
+        MENUITEM "Dump body text...",     IDM_DUMP_BODY_TEXT
+        MENUITEM "Dump render tree...",   IDM_DUMP_RENDER_TREE
+        MENUITEM SEPARATOR
+        MENUITEM "Enable images",         IDM_ENABLE_IMAGES, CHECKED
+        MENUITEM "Enable plugins",        IDM_ENABLE_PLUGINS, CHECKED
+        MENUITEM "Enable scripts",        IDM_ENABLE_SCRIPTS, CHECKED
+        MENUITEM SEPARATOR
+        MENUITEM "Show developer tools...",  IDM_SHOW_DEV_TOOLS
+    END
+    POPUP "&Help"
+    BEGIN
+        MENUITEM "&About ...",           IDM_ABOUT
+    END
+END
+
+
+/////////////////////////////////////////////////////////////////////////////
+//
+// Accelerator
+//
+
+IDC_TESTSHELL ACCELERATORS
+BEGIN
+    "?",            IDM_ABOUT,              ASCII,  ALT
+    "/",            IDM_ABOUT,              ASCII,  ALT
+END
+
+
+/////////////////////////////////////////////////////////////////////////////
+//
+// Dialog
+//
+
+IDD_ABOUTBOX DIALOG   22, 17, 230, 75
+STYLE DS_MODALFRAME | WS_CAPTION | WS_SYSMENU
+CAPTION "About"
+FONT 8, "System"
+BEGIN
+    ICON            IDI_TESTSHELL,IDC_MYICON,14,9,16,16
+    LTEXT           "TestShell Version 1.0",IDC_STATIC,49,10,119,8,SS_NOPREFIX
+    LTEXT           "Copyright (C) 2006",IDC_STATIC,49,20,119,8
+    DEFPUSHBUTTON   "OK",IDOK,195,6,30,11,WS_GROUP
+END
+
+#ifdef APSTUDIO_INVOKED
+/////////////////////////////////////////////////////////////////////////////
+//
+// TEXTINCLUDE
+//
+1 TEXTINCLUDE  
+BEGIN
+    "resource.h\0"
+END
+
+2 TEXTINCLUDE  
+BEGIN
+    "#define APSTUDIO_HIDDEN_SYMBOLS\r\n"
+    "#include ""windows.h""\r\n"
+    "#undef APSTUDIO_HIDDEN_SYMBOLS\r\n"
+    "\0"
+END
+
+3 TEXTINCLUDE  
+BEGIN
+    "\r\n"
+    "\0"
+END
+
+#endif    // APSTUDIO_INVOKED
+
+/////////////////////////////////////////////////////////////////////////////
+//
+// String Table
+//
+
+STRINGTABLE  
+BEGIN
+   IDC_TESTSHELL       "TESTSHELL"
+   IDS_APP_TITLE       "TestShell"
+END
+
+#endif
+/////////////////////////////////////////////////////////////////////////////
+
+
+
+#ifndef APSTUDIO_INVOKED
+/////////////////////////////////////////////////////////////////////////////
+//
+// Generated from the TEXTINCLUDE 3 resource.
+//
+
+/////////////////////////////////////////////////////////////////////////////
+#endif    // not APSTUDIO_INVOKED
diff '--exclude=.svn' -aurN cef.ori/resources/fonts.conf cef/resources/fonts.conf
--- resources/fonts.conf	1970-01-01 01:00:00.000000000 +0100
+++ resources/fonts.conf	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,229 @@
+<?xml version="1.0"?>
+<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
+<!-- /etc/fonts/fonts.conf file to configure system font access -->
+<fontconfig>
+  <match target="font">
+    <edit name="embeddedbitmap" mode="assign"><bool>false</bool></edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>Times</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Times New Roman</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>sans</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>sans serif</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+  </match>
+
+  <!-- Some layout tests specify Helvetica as a family and we need to make sure
+       that we don't fallback to Times New Roman for them -->
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>Helvetica</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>sans-serif</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>serif</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Times New Roman</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>mono</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Courier New</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>monospace</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Courier New</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>Courier</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Courier New</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>cursive</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Comic Sans MS</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>fantasy</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Impact</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test qual="any" name="family">
+      <string>Monaco</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Times New Roman</string>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test name="family" compare="eq">
+      <string>NonAntiAliasedSans</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+    <edit name="antialias" mode="assign">
+      <bool>false</bool>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test name="family" compare="eq">
+      <string>SlightHintedGeorgia</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Georgia</string>
+    </edit>
+    <edit name="hintstyle" mode="assign">
+      <const>hintslight</const>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test name="family" compare="eq">
+      <string>NonHintedSans</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Verdana</string>
+    </edit>
+    <!-- These deliberately contradict each other. The 'hinting' preference
+         should take priority -->
+    <edit name="hintstyle" mode="assign">
+      <const>hintfull</const>
+    </edit>
+   <edit name="hinting" mode="assign">
+      <bool>false</bool>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test name="family" compare="eq">
+      <string>AutohintedSerif</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+    <edit name="autohint" mode="assign">
+      <bool>true</bool>
+    </edit>
+    <edit name="hintstyle" mode="assign">
+      <const>hintmedium</const>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test name="family" compare="eq">
+      <string>HintedSerif</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+    <edit name="autohint" mode="assign">
+      <bool>false</bool>
+    </edit>
+    <edit name="hintstyle" mode="assign">
+      <const>hintmedium</const>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test name="family" compare="eq">
+      <string>FullAndAutoHintedSerif</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+    <edit name="autohint" mode="assign">
+      <bool>true</bool>
+    </edit>
+    <edit name="hintstyle" mode="assign">
+      <const>hintfull</const>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test name="family" compare="eq">
+      <string>SubpixelEnabledArial</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+    <edit name="rgba" mode="assign">
+      <const>rgb</const>
+    </edit>
+  </match>
+
+  <match target="pattern">
+    <test name="family" compare="eq">
+      <string>SubpixelDisabledArial</string>
+    </test>
+    <edit name="family" mode="assign">
+      <string>Arial</string>
+    </edit>
+    <edit name="rgba" mode="assign">
+      <const>none</const>
+    </edit>
+  </match>
+
+</fontconfig>
diff '--exclude=.svn' -aurN cef.ori/resources/missingImage.gif cef/resources/missingImage.gif
--- resources/missingImage.gif	1970-01-01 01:00:00.000000000 +0100
+++ resources/missingImage.gif	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,3 @@
+GIF89a     hp(x px(hp0(0xx pp( x@P(xP                                                                                             ,       pH,f,r 7z\Qv=\v2Y4:Ws!4 vxm  
+
+  LIA ;
\ Kein Zeilenumbruch am Dateiende.
diff '--exclude=.svn' -aurN cef.ori/resources/missingImage.png cef/resources/missingImage.png
--- resources/missingImage.png	1970-01-01 01:00:00.000000000 +0100
+++ resources/missingImage.png	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,6 @@
+PNG
+
+   IHDR         h6   	pHYs    ~  MIDAT(RA+Da={O,d+%~$,4K7L!{+vi0is7cc{={>""tYuX(_Y}>I)2
+(i 0sgTd$ Z c3IEJ\^)O{cq`d yLHdAR^zUeZ1V`yZf{i
++tXJUyiT^2QJoK4K	f) \*RK
+22u0*%H..Yn-9>i h_    IENDB`
\ Kein Zeilenumbruch am Dateiende.
diff '--exclude=.svn' -aurN cef.ori/resources/README.txt cef/resources/README.txt
--- resources/README.txt	1970-01-01 01:00:00.000000000 +0100
+++ resources/README.txt	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,26 @@
+missingImage.gif was created from Webkit data: WebCore/Resources/missingImage.tiff
+
+Licence text for missingImage.tiff from which missingImage.gif was generated:
+
+Copyright (C) 2003, 2004, 2005, 2006 Apple Computer, Inc.  All rights reserved.
+Redistribution and use in source and binary forms, with or without
+modification, are permitted provided that the following conditions
+are met:
+1. Redistributions of source code must retain the above copyright
+   notice, this list of conditions and the following disclaimer.
+2. Redistributions in binary form must reproduce the above copyright
+   notice, this list of conditions and the following disclaimer in the
+   documentation and/or other materials provided with the distribution.
+THIS SOFTWARE IS PROVIDED BY APPLE COMPUTER, INC. ``AS IS'' AND ANY
+EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
+PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE COMPUTER, INC. OR
+CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
+EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
+PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
+PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
+OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+missingImage.png is the same as WebCore/Resources/missingImage.png and carries exactly the same license.
diff '--exclude=.svn' -aurN cef.ori/resources/small.ico cef/resources/small.ico
--- resources/small.ico	1970-01-01 01:00:00.000000000 +0100
+++ resources/small.ico	2012-05-09 11:32:01.668658220 +0200
@@ -0,0 +1,19 @@
+                     (  n  00                >      h    00     %  N!           F       h  W  (       @                                                                                  wwwwwwwwwwwwwwwpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxpxwwwwwwwwwwwwwxpxpxDDDDDDDDD@    pxDDDDDDDDDHpxDDDDDDDDDHpxDDDDDDDDDDDDDDpxpwwwwwwwwwwwwwwwp                                                                                                                                (                                                                                 wwwwwwwpxpxpxpxpxpxpxpxwwwwwwpxDDDpxDDDDDDpxpwwwwwwww                                                                (   0   `                             qj {r     R' Q' P' H# S$ S% R& S& R& R' hC W! V" V" U# U$ iP Z Z Y X  X  ^ ] ] [ \ a ` ` _ g g d c l
+ k i i h i e) P b  b b t s _ [ [ c r v p b q o p x
+ n	 h	 w o t y" }' , 3 E @ U |  s  q  f  c  b  c  t u t r j e c c ] [ \ u v t u t e ] \ v u v u q n o \ v w u v u w v w w v w x	 x
+ y z z z { y w  t t ' ( , , - - . 0 0 0 0 1 3 1 6 7 8 8 8 : = > = @ ? B D E I I I S ^             Fp cq  sss ppp iii aaa ``` ___ ]]] [[[ YYY XXX                                                                                                                                                                                                                                                                     	
+! %%$$"#"#"#*+()''&&??<=9;7A63[4]5mm]5\]m]mm5\mm5555555\\\5\\\5m\55\\5ed:cOXY/P.Z0.0.QR00/ZPP0000000/0PPZR.BI@/DE0, CWkV21TSav^8{|}>qooggggggg1`_fhsnHK{JLpGl-FjNw~ytMMMMMMUbbrrrrrxxxxxxxxrriUMMMMMMMMMUuzt                                                                                                                                                                                                                                                                                                 (       @                             ~r     YRO M" M" M" O$ S( S) xH0 ~L3 wG0 wH0 rE. xI1 YB \TP XRO K N! O" N" N" O$ xI0 pE. ZSO h: lA j@ s z B  @  i7 q r YSO b_] F  E  C  D  E  C  n5 l6 f> n s [TO L  I  J  I  s- r. p0 o1 j _ k l m ZTO Y  K  I w* v, h i i  Y  S  {$ z& x' e f m  k  l  m  n  o  n  j  m  k  q } $ * * 7 ? D ; @ Q b c b b o  f  q r x    { z { z u              !  $ ! & ' * + - * / / 3 3 5 6 5 7 7 8 ; = ? 7 V p  ^][                       .j   ttt ```                                                                                                                                                                                                                                                                                         		
+&1"$.#%-0%:?%9>%8=%7;EG@DF@MO@LN2Kh2\g2]f2[I3')+*+)))*))()*+++,6J!54 CBAjYPQTVTSkllZTTXRTUiHceWda/ iu`_<bmt^}zy|yx~{|yvrrwsqpon                                                                         (                                        |WR  Q3 O1 b sP? Q2 Q2 Y9 ^G  `E  cE bE   o7 f@ gD eD     b c c d c d d s  x( > zZ   g  x $ & * + + , - - / 0 4 6 I                        ~~~ }}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 PPPPPPPPPPPPPPPPPKMNNNNNNNNNNOLO	O&:
+OJHHGGGGGGGGHI
+OJEEEEEEEEEEFCOJEEEEEEEEEEFCOJEEEEEEEEEEFDOJEFEEEEEEEEEBO%JEEEEEEEEEFFBOJJIIIIJIIIIJJO(@>=77A779?<8;$O' "!)O6530./21+*-,4#4PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP                        (   0   `                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'H#P'Q'Q'Q'Q'      Q&R&R&R'R&R&R&R&R&Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'Q'R'      R&S&      S%S$      U$U#      V"V"      W!X       YX       ZZ      \[      ]]      ^_      ``      aa      aa      aa      aa      aa      aa      aa      cc      dd      gg      gg      gg      hi   ii   !kk   "l
+l
+   "n	n	   "op   "pq   !rw   c_][\[\\\[[\\\\\[[\\[[[[[[[[[[[[[[[\[[[[[[\]bt   ef ecbc b cbb bb b c bbbcc c bbbbbbbbbc c cc b o@h	by"}'be)qjiPtt   jnrstutuwuvy{z{zx
+vwwuuuuuuuttvvvwvE|yUu{rFpcq3w      oyS^EDIID:BI638?@=>>=======8,00-.(',0-0178P,1q   J   w 1q vzx	vs s s s s s tttuuuuuwwwwwwwwuuuts s s s s s s s s twx
+v` W                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (       @                                                                                                                                                                                                                                                                                                                                                                                                     ^                                                                                       i   G >:98889:::::::::::::::::::::i2	   ,KS(O$N!N!N!N!N"M"M"M"M"M"M"M"M"M"M"M"M"M"M"M"M"N"M"M"O$S)O"   1lAs#   -j@z
+   +h:s	    +i7r
+    +l6q
+    +n5n
+    +o1m    +p0l    *r.k    #r.k    "s-j    "v,i    "w*h    "x'f    "z&e    "{$b    "$b    "*c    "}7   "Y L F C E D E C C C D C C E C C D E E E C I S @ J I B IK Y    $f k m k n n n m qrrqn n m m l n o o i @bj QDf>.j~ro    n *V=;?73?//87566-&*'!+3$357_;xh   t bx}{zz
+|z	y
+|}}~{|z	ys s yt t { } |m                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  (                                                                                      
+      k                                       {   OO&F#C!C!C!C!C!C!C!C!C!C!A E$R(   prE+   pqD)   ptF'   pwH'   pzI&   p}L%   pN%   pM!   p}c>   pcdcdddcbccx(s o7|WRzW   Ry*$1mp   	                                                                                                                                 :                          
\ Kein Zeilenumbruch am Dateiende.
diff '--exclude=.svn' -aurN cef.ori/resources/textAreaResizeCorner.png cef/resources/textAreaResizeCorner.png
--- resources/textAreaResizeCorner.png	1970-01-01 01:00:00.000000000 +0100
+++ resources/textAreaResizeCorner.png	2012-05-09 11:32:01.669658220 +0200
@@ -0,0 +1,3 @@
+PNG
+
+   IHDR            	pHYs        gAMA  |Q    cHRM  z%        u0  `  :  o_F   9IDATx|  ^J%e5,tj|6vjHf7h8 @3=XWk    IENDB`
\ Kein Zeilenumbruch am Dateiende.
diff '--exclude=.svn' -aurN cef.ori/tests/cefclient/cefclient_gtk.cpp cef/tests/cefclient/cefclient_gtk.cpp
--- tests/cefclient/cefclient_gtk.cpp	1970-01-01 01:00:00.000000000 +0100
+++ tests/cefclient/cefclient_gtk.cpp	2012-05-09 11:32:01.669658220 +0200
@@ -0,0 +1,397 @@
+#include "include/cef.h"
+#include "cefclient.h"
+#include "client_handler.h"
+
+#include "binding_test.h"
+#include "extension_test.h"
+#include "scheme_test.h"
+
+#include <gtk/gtk.h>
+#include <stdlib.h>
+#include <unistd.h>
+#include "string_util.h"
+#include <iostream>
+
+#include "ui/base/resource/resource_bundle.h"
+#include "base/path_service.h"
+
+using namespace std;
+
+char szWorkingDir[512]; // The current working directory
+
+// The global ClientHandler reference.
+extern CefRefPtr<ClientHandler> g_handler;
+
+void destroy(void) {
+    CefShutdown();
+    exit(0);
+}
+
+// Callback for Debug > Get Source... menu item.
+gboolean GetSourceActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunGetSourceTest(g_handler->GetBrowser());  
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Get Source... menu item.
+gboolean GetTextActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunGetTextTest(g_handler->GetBrowser());  
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > JS Binding... menu item.
+gboolean JSBindngActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunBindingTest(g_handler->GetBrowser());  
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > JS Extension... menu item.
+gboolean JSExtensionActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunExtensionTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > JS Execute... menu item.
+gboolean JSExecuteActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunJavaScriptExecuteTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Request... menu item.
+gboolean RequestActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunRequestTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Local Storage... menu item.
+gboolean LocalStorageActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunLocalStorageTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > XMLHttpRequest... menu item.
+gboolean XMLHttpRequestActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunXMLHTTPRequestTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > WebURLRequest... menu item.
+gboolean WebURLRequestActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunWebURLRequestTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > DOM Access... menu item.
+gboolean DOMAccessActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunDOMAccessTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Scheme Handler... menu item.
+gboolean SchemeHandlerActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunSchemeTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Popup Window... menu item.
+gboolean PopupWindowActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunPopupTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Accelerated 2D Canvas:... menu item.
+gboolean Accelerated2DCanvasActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunAccelerated2DCanvasTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Accelerated Layers:... menu item.
+gboolean AcceleratedLayersActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunAcceleratedLayersTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > WebGL:... menu item.
+gboolean WebGLActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunWebGLTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > HTML5 Video... menu item.
+gboolean HTML5VideoActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	RunHTML5VideoTest(g_handler->GetBrowser());
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Zoom In... menu item.
+gboolean ZoomInActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	CefRefPtr<CefBrowser> browser = g_handler->GetBrowser();
+    	browser->SetZoomLevel(browser->GetZoomLevel() + 0.5);
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Zoom Out... menu item.
+gboolean ZoomOutActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	CefRefPtr<CefBrowser> browser = g_handler->GetBrowser();
+    	browser->SetZoomLevel(browser->GetZoomLevel() - 0.5);
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for Debug > Zoom Reset... menu item.
+gboolean ZoomResetActivated(GtkWidget* widget) {
+ 	if(g_handler.get() && g_handler->GetBrowserHwnd()) {
+    	CefRefPtr<CefBrowser> browser = g_handler->GetBrowser();
+    	browser->SetZoomLevel(0.0);
+	}
+	
+	return FALSE;  // Don't stop this message.
+}
+
+// Callback for when you click the back button.
+void BackButtonClicked(GtkButton* button) {
+  	if (g_handler.get() && g_handler->GetBrowserHwnd())
+	{
+    	g_handler->GetBrowser()->GoBack();
+	}
+}
+
+// Callback for when you click the forward button.
+void ForwardButtonClicked(GtkButton* button) {
+	if (g_handler.get() && g_handler->GetBrowserHwnd())
+	{
+    	g_handler->GetBrowser()->GoForward();
+	}
+}
+
+// Callback for when you click the stop button.
+void StopButtonClicked(GtkButton* button) {
+  	if (g_handler.get() && g_handler->GetBrowserHwnd())
+	{
+    	g_handler->GetBrowser()->StopLoad();
+	}
+}
+
+// Callback for when you click the reload button.
+void ReloadButtonClicked(GtkButton* button) {
+    if (g_handler.get() && g_handler->GetBrowserHwnd())
+	{
+    	g_handler->GetBrowser()->Reload();
+	}
+}
+
+// Callback for when you press enter in the URL box.
+void URLEntryActivate(GtkEntry* entry) {
+  	if (!g_handler.get() || !g_handler->GetBrowserHwnd())
+	{
+    	return;
+	}
+  
+  	const gchar* url = gtk_entry_get_text(entry);
+  	g_handler->GetBrowser()->GetMainFrame()->LoadURL(std::string(url).c_str());
+}
+
+// GTK utility functions ----------------------------------------------
+
+GtkWidget* AddMenuEntry(GtkWidget* menu_widget, const char* text,
+        GCallback callback) {
+    GtkWidget* entry = gtk_menu_item_new_with_label(text);
+    gtk_menu_shell_append(GTK_MENU_SHELL(menu_widget), entry);
+    return entry;
+}
+
+GtkWidget* CreateMenu(GtkWidget* menu_bar, const char* text) {
+    GtkWidget* menu_widget = gtk_menu_new();
+    GtkWidget* menu_header = gtk_menu_item_new_with_label(text);
+    gtk_menu_item_set_submenu(GTK_MENU_ITEM(menu_header), menu_widget);
+    gtk_menu_shell_append(GTK_MENU_SHELL(menu_bar), menu_header);
+    return menu_widget;
+}
+
+GtkWidget* CreateMenuBar() {
+    GtkWidget* menu_bar = gtk_menu_bar_new();
+  	GtkWidget* debug_menu = CreateMenu(menu_bar, "Tests");
+  	
+	AddMenuEntry(debug_menu, "Get Source",
+               G_CALLBACK(GetSourceActivated));
+  	AddMenuEntry(debug_menu, "Get Text",
+               G_CALLBACK(GetTextActivated));
+  	AddMenuEntry(debug_menu, "JS Binding",
+               G_CALLBACK(JSBindngActivated));
+	AddMenuEntry(debug_menu, "JS Extension",
+               G_CALLBACK(JSExtensionActivated));
+	AddMenuEntry(debug_menu, "JS Execute",
+               G_CALLBACK(JSExecuteActivated));
+	AddMenuEntry(debug_menu, "Request",
+               G_CALLBACK(RequestActivated));
+	AddMenuEntry(debug_menu, "Local Storage",
+               G_CALLBACK(LocalStorageActivated));
+	AddMenuEntry(debug_menu, "XMLHttpRequest",
+               G_CALLBACK(XMLHttpRequestActivated));
+	AddMenuEntry(debug_menu, "DOM Access",
+               G_CALLBACK(DOMAccessActivated));
+	AddMenuEntry(debug_menu, "Scheme Handler",
+               G_CALLBACK(SchemeHandlerActivated));
+	AddMenuEntry(debug_menu, "Popup Window",
+               G_CALLBACK(PopupWindowActivated));
+	AddMenuEntry(debug_menu, "Accelerated 2D Canvas",
+               G_CALLBACK(Accelerated2DCanvasActivated));
+	AddMenuEntry(debug_menu, "Accelerated Layers",
+               G_CALLBACK(AcceleratedLayersActivated));
+	AddMenuEntry(debug_menu, "WebGL",
+               G_CALLBACK(WebGLActivated));
+	AddMenuEntry(debug_menu, "HTML5 Video",
+               G_CALLBACK(HTML5VideoActivated));
+	AddMenuEntry(debug_menu, "Zoom In",
+               G_CALLBACK(ZoomInActivated));
+	AddMenuEntry(debug_menu, "Zoom Out",
+               G_CALLBACK(ZoomOutActivated));
+	AddMenuEntry(debug_menu, "Zoom Reset",
+               G_CALLBACK(ZoomResetActivated));
+  	
+	return menu_bar;
+}
+
+int main(int argc, char *argv[]) {
+    getcwd(szWorkingDir, sizeof (szWorkingDir));
+
+    GtkWidget *window;
+
+    gtk_init(&argc, &argv);
+
+    CefSettings settings;
+    CefInitialize(settings);
+	
+	FilePath data_path;
+  	PathService::Get(base::DIR_EXE, &data_path);
+  	data_path = data_path.Append("chrome.pak");
+  	ResourceBundle::InitSharedInstanceForTest(data_path);
+
+    window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
+    gtk_window_set_default_size(GTK_WINDOW(window), 800, 600);
+    gtk_window_set_title(GTK_WINDOW(window), "CEF Client");
+
+    GtkWidget* vbox = gtk_vbox_new(FALSE, 0);
+
+    GtkWidget* menu_bar = CreateMenuBar();
+
+    gtk_box_pack_start(GTK_BOX(vbox), menu_bar, FALSE, FALSE, 0);
+
+    GtkWidget* toolbar = gtk_toolbar_new();
+    // Turn off the labels on the toolbar buttons.
+    gtk_toolbar_set_style(GTK_TOOLBAR(toolbar), GTK_TOOLBAR_ICONS);
+
+    GtkToolItem* back = gtk_tool_button_new_from_stock(GTK_STOCK_GO_BACK);
+  	g_signal_connect(back, "clicked",
+                   G_CALLBACK(BackButtonClicked), NULL);
+  	gtk_toolbar_insert(GTK_TOOLBAR(toolbar), back, -1 /* append */);
+
+  	GtkToolItem* forward = gtk_tool_button_new_from_stock(GTK_STOCK_GO_FORWARD);
+  	g_signal_connect(forward, "clicked",
+                   G_CALLBACK(ForwardButtonClicked), NULL);
+  	gtk_toolbar_insert(GTK_TOOLBAR(toolbar), forward, -1 /* append */);
+
+  	GtkToolItem* reload = gtk_tool_button_new_from_stock(GTK_STOCK_REFRESH);
+  	g_signal_connect(reload, "clicked",
+                   G_CALLBACK(ReloadButtonClicked), NULL);
+  	gtk_toolbar_insert(GTK_TOOLBAR(toolbar), reload, -1 /* append */);
+
+  	GtkToolItem* stop = gtk_tool_button_new_from_stock(GTK_STOCK_STOP);
+  	g_signal_connect(stop, "clicked",
+                   G_CALLBACK(StopButtonClicked), NULL);
+  	gtk_toolbar_insert(GTK_TOOLBAR(toolbar), stop, -1 /* append */);
+
+    GtkWidget* m_editWnd = gtk_entry_new();
+	g_signal_connect(G_OBJECT(m_editWnd), "activate",
+                   G_CALLBACK(URLEntryActivate), NULL);
+    gtk_entry_set_text(GTK_ENTRY(m_editWnd), "http://www.google.com");
+
+    GtkToolItem* tool_item = gtk_tool_item_new();
+    gtk_container_add(GTK_CONTAINER(tool_item), m_editWnd);
+    gtk_tool_item_set_expand(tool_item, TRUE);
+    gtk_toolbar_insert(GTK_TOOLBAR(toolbar), tool_item, -1); //append
+
+    gtk_box_pack_start(GTK_BOX(vbox), toolbar, FALSE, FALSE, 0);
+
+    gtk_signal_connect(GTK_OBJECT(window), "destroy", GTK_SIGNAL_FUNC(destroy), NULL);
+
+    // Create the handler.
+    g_handler = new ClientHandler();
+    g_handler->SetMainHwnd(vbox);
+
+    // Create the browser view.
+    CefWindowInfo window_info;
+    CefBrowserSettings browserSettings;
+    window_info.SetAsChild(vbox);
+
+	//bool success = CefBrowser::CreateBrowser(window_info, static_cast<CefRefPtr<CefClient> >(g_handler), "http://www.google.com", browserSettings);
+	//cout << "Created browser: " <<  success << endl;
+
+	CefBrowser::CreateBrowserSync(window_info, static_cast<CefRefPtr<CefClient> >(g_handler), "http://www.google.com", browserSettings);
+
+    gtk_container_add(GTK_CONTAINER(window), vbox);
+    gtk_widget_show_all(GTK_WIDGET(window));
+
+    CefRunMessageLoop();
+
+    return 0;
+}
+
+// Global functions
+
+std::string AppGetWorkingDirectory() {
+    return szWorkingDir;
+}
